var LearningTools,ReadingViewViewer,ReadingMode;let selectionHandler;!function(e){let t,i;!function(e){e[e.Unknown=0]="Unknown",e[e.Success_200_OK=200]="Success_200_OK",e[e.Success_201_Created=201]="Success_201_Created",e[e.Success_202_Accepted=202]="Success_202_Accepted",e[e.Success_204_NoContent=204]="Success_204_NoContent",e[e.ClientError_400_BadRequest=400]="ClientError_400_BadRequest",e[e.ClientError_401_Unauthorized=401]="ClientError_401_Unauthorized",e[e.ClientError_403_Forbidden=403]="ClientError_403_Forbidden",e[e.ClientError_404_NotFound=404]="ClientError_404_NotFound",e[e.ClientError_405_MethodNotAllowed=405]="ClientError_405_MethodNotAllowed",e[e.ClientError_408_RequestTimeout=408]="ClientError_408_RequestTimeout",e[e.ClientError_409_Conflict=409]="ClientError_409_Conflict",e[e.ClientError_410_Gone=410]="ClientError_410_Gone",e[e.ClientError_412_PreconditionFailed=412]="ClientError_412_PreconditionFailed",e[e.ServerError_500_InternalServerError=500]="ServerError_500_InternalServerError",e[e.ServerError_501_NotImplemented=501]="ServerError_501_NotImplemented",e[e.ServerError_503_ServiceUnavailable=503]="ServerError_503_ServiceUnavailable",e[e.ServerError_505_VersionNotSupported=505]="ServerError_505_VersionNotSupported"}(t=e.ApiStatus||(e.ApiStatus={})),function(e){e[e.NotSupported=0]="NotSupported",e[e.Supported_NotInstalled=100]="Supported_NotInstalled",e[e.Supported_InstallPending=101]="Supported_InstallPending",e[e.Installed=200]="Installed",e[e.Installed_UpdateAvailable=201]="Installed_UpdateAvailable",e[e.Supported_FailedInstall=500]="Supported_FailedInstall"}(i=e.LanguageStatus||(e.LanguageStatus={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.idle=0]="idle",e[e.activationRequested=1]="activationRequested",e[e.firstResponseCompleted=2]="firstResponseCompleted",e[e.firstResponseFailed=3]="firstResponseFailed",e[e.firstResponseCancelled=4]="firstResponseCancelled",e[e.deactivationRequested=5]="deactivationRequested"}(t=e.ComprehensionToolsState||(e.ComprehensionToolsState={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.syllables=1]="syllables",e[e.nouns=2]="nouns",e[e.verbs=4]="verbs",e[e.adjectives=8]="adjectives",e[e.pos=14]="pos"}(t=e.ComprehensionToolType||(e.ComprehensionToolType={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e.NONEMPTY_STRING_REGEX=new RegExp("\\S"),e.adjustTextByLength=function(e,t,i){var s=[],n="";return e.forEach(e=>{if(n.length+e.length<=t)n+=e;else{for(var o=function(e,t,i){for(var s=[],n=e,o=i;n.length>0;){if(n.length>i){o=i;for(var r=0;r<t.length;r++){var h=n.lastIndexOf(t[r],o-1);if(h>0){o=h+1;break}}}else o=n.length;s.push(n.substr(0,o)),n=n.substr(o)}return s}(e,i,t),r=0;r<o.length&&n.length+o[r].length<=t;r++)n+=o[r],o.shift();n.length>0&&(s.push(n),n=""),o.forEach(e=>{s.push(e)})}}),n.length>0&&s.push(n),s},e.skipText=function(e,t){for(var i=0,s=0;s<e.length&&t>=e[s].length;s++)i++,t-=e[s].length;return i>0&&e.splice(0,i),e.length>0&&t>0&&(e[0]=e[0].substring(t)),e},e.isNullOrEmpty=function(e){return void 0===e||null===e||0===e.length},e.replaceLinebreaksWithSpaces=function(e){return e.replace(/[\r\n]/g," ")}}(t=e.StringUtilties||(e.StringUtilties={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(t){t.createTreeTextNodeWalker=function(t){return t.ownerDocument.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:t=>e.StringUtilties.isNullOrEmpty(t.textContent)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},!1)},t.moveByTextOffset=function(e,t){let i=e.currentNode,s=i.length,n=0;for(;i&&t>n+s;){if(n+=s,!(i=e.nextNode()))throw new Error("Index out of bounds");s=i.length}return n}}(t=e.TreeNodeWalker||(e.TreeNodeWalker={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.Next=0]="Next",e[e.Previous=1]="Previous"}(t=e.UnitDirection||(e.UnitDirection={}));class i{setStartingNode(e,s){this.i=t.Next,this.h=null,this.u=e?e.ownerDocument.body:null,this.g=i.getUnitContainer(e),this.m=e;let n=e;for(;n&&n!==this.g&&!i.isUnitContainer(n);)this.m=n,n=n.previousSibling?n.previousSibling:n.parentNode;for(;this.m&&i.shouldSkipNode(this.m);)this.m=i.getNextSubtreeNode(this.u,this.m);e&&this.m&&(e===this.m||0!=(e.compareDocumentPosition(this.m)&Node.DOCUMENT_POSITION_PRECEDING))&&(this.L=s||0,this.v=this.m===e?null:e)}moveByAUnit(e){let s,n=0,o=!0;if(this.u&&this.g)for(this.adjustCurrentNodeForDirection(e),s=[];this.m;){o&&(o=this.v&&0!=(this.v.compareDocumentPosition(this.m)&Node.DOCUMENT_POSITION_PRECEDING));var r=!1;if(e===t.Next&&this.m===this.g.nextSibling||e===t.Previous&&this.m===this.g.previousSibling)this.g=i.getUnitContainer(this.m),r=!0;else for(this.m.nodeType===Node.TEXT_NODE&&(s.push(this.m),o&&(n+=this.m.textContent.length)),this.m=i.moveByANode(this.u,this.m,e),i.isUnitContainer(this.m)&&(this.g=this.m,r=!0);this.m&&i.shouldSkipNode(this.m);)this.m=i.moveByASubtree(this.u,this.m,e),i.isUnitContainer(this.m)&&(this.g=this.m,r=!0);if(r){if(!i.areEmptyOrWhiteSpaceTextNodes(s))break;o=!1,n=0,this.L=0,this.v=null,s=[]}}return this.h=i.createReadingUnit(s,this.L+n,e),this.v=null,this.L=0,this.h}static getNextReadingNode(e,t){return t.hasChildNodes()?t.firstChild:i.getNextSubtreeNode(e,t)}static getPreviousReadingNode(e,t){return t.hasChildNodes()?t.lastChild:i.getPreviousSubtreeNode(e,t)}static shouldSkipNode(t){if(t&&t.nodeType===Node.ELEMENT_NODE){if(!e.StringUtilties.NONEMPTY_STRING_REGEX.test(t.textContent))return!0;if(i.NodeIgnoreList.indexOf(t.nodeName.toUpperCase())>-1)return!0;var s=window.getComputedStyle(t);if("none"===s.display.toLowerCase()||"hidden"===s.visibility.toLowerCase()||t.hidden||parseInt(s.width)<=5&&("hidden"===s.overflow.toLowerCase()||"hidden"===s.overflowX.toLowerCase())||parseInt(s.height)<=5&&("hidden"===s.overflow.toLowerCase()||"hidden"===s.overflowY.toLowerCase())||Math.abs(parseInt(s.textIndent))>t.scrollWidth)return!0}return!1}static getPreviousSubtreeNode(e,t){for(;t&&t!==e&&!t.previousSibling;)t=t.parentNode;return t&&t!==e?t.previousSibling:null}static getNextSubtreeNode(e,t){for(;t&&t!==e&&!t.nextSibling;)t=t.parentNode;return t&&t!==e?t.nextSibling:null}adjustCurrentNodeForDirection(e){this.i!==e&&(this.h&&this.h.textNodes&&this.h.textNodes.length>0?(this.m=e===t.Next?i.getNextReadingNode(this.u,this.h.textNodes[this.h.textNodes.length-1]):i.getPreviousReadingNode(this.u,this.h.textNodes[this.h.textNodes.length-1]),this.g=i.getUnitContainer(this.m)):this.m=this.u,this.i=e)}static createReadingUnit(e,s,n){return e&&e.length>0&&!i.areEmptyOrWhiteSpaceTextNodes(e)?{textNodes:n===t.Next?e:e.reverse(),textOffset:s}:null}static areEmptyOrWhiteSpaceTextNodes(t){return 0===t.length||!t.some(t=>e.StringUtilties.NONEMPTY_STRING_REGEX.test(t.textContent))}static moveByANode(e,s,n){return n===t.Next?i.getNextReadingNode(e,s):i.getPreviousReadingNode(e,s)}static moveByASubtree(e,s,n){return n===t.Next?i.getNextSubtreeNode(e,s):i.getPreviousSubtreeNode(e,s)}static getUnitContainer(e){for(;e&&!i.isUnitContainer(e);)e=e.parentNode;return e}static isUnitContainer(e){if(e&&e.nodeType===Node.ELEMENT_NODE){var t=e.tagName.toLowerCase();return["body","div","p","address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","nav","section","main","figcaption","ul","ol","dl","li","dt","dd","pre","td","th","caption","summary","details","button","legend","label","textarea"].indexOf(t)>-1}return!1}}i.NodeIgnoreList=["NOSCRIPT","SCRIPT","STYLE","SELECT"],e.ReadingUnitNavigator=i}(LearningTools||(LearningTools={})),function(e){let t;!function(t){const i=["mssyllable"];function s(e,t,i){let s=t.ownerDocument.createElement(e);return i.forEach(e=>{s.classList.add(e)}),s.appendChild(t.parentNode.replaceChild(s,t)),s}function n(e,t){let i=e.textContent;if(t<0||t>i.length)throw new Error("Bad index for splitText");let s=i.substr(0,t),n=i.substr(t),o=e.ownerDocument.createTextNode(s),r=e.ownerDocument.createTextNode(n);return e.parentNode.insertBefore(o,e),e.parentNode.insertBefore(r,e),e.parentNode.removeChild(e),{firstPart:o,secondPart:r}}t.surroundTextByTag=function(t,o,r,h,a,l,u){let d=[],c=[],g=o.startContainer,m=o.startOffset,f=o.endContainer,w=o.endOffset,L=g.nodeType===Node.TEXT_NODE?g:g.childNodes.item(m),v=f.nodeType===Node.TEXT_NODE?f:f.childNodes.item(w);for(;L&&(L.nodeType===Node.TEXT_NODE&&r(L)?d.push(L):L.nodeType===Node.ELEMENT_NODE&&i.indexOf(L.tagName.toLowerCase())>-1&&c.push(L),L!==v);)L=e.ReadingUnitNavigator.getNextReadingNode(o.commonAncestorContainer,L);let T=[];for(let e=0;e<d.length;e++){let i=d[e];if(i===g&&m>0){let e=i===f&&w>0,t=n(i,m);if(h(i,[t.firstPart,t.secondPart]),i=t.secondPart,e){let e=n(i,w-m);h(i,[e.firstPart,e.secondPart]),i=e.firstPart}}else if(i===f){let e=n(i,w);h(i,[e.firstPart,e.secondPart]),i=e.firstPart}T.push(s(t,i,a))}return c.forEach(e=>{T.push(s(t,e,a))}),l&&T[0]&&T[0].setAttribute("aria-label",l),u&&T[0]&&u.forEach((e,t)=>{T[0].setAttribute(t,e)}),{value:()=>T,release:()=>{for(let e=0;e<T.length;e++){let t=T[e],i=t.parentNode;if(i){for(;t.firstChild;){let e=t.firstChild;t.removeChild(e),i.insertBefore(e,t)}i.removeChild(t),i.normalize()}}T=null}}}}(t=e.Highlighter||(e.Highlighter={}))}(LearningTools||(LearningTools={})),function(e){class t{constructor(t,i,s){this.T=t,this.p=e.TreeNodeWalker.createTreeTextNodeWalker(this.T.body),this.setStartingElementNode(this.T.body),this.R=i,this.V=s}setStartingElementNode(e){this.p.currentNode=e||this.T.body,this._=this.p.nextNode()}getNextNLXUnit(){if(this._){let i,s=this._,n="",o=[],r=this.getNonIgnoredParentElement(s);for(;s&&(n.length<this.R||t.IgnoreTagList.findIndex(e=>e===s.parentElement.tagName.toLowerCase())>-1);)r!==(i=this.getNonIgnoredParentElement(s))&&(o.push(n.length),n+="\n"),n+=s.textContent,r=i,s=this.p.nextNode();let h=this._.ownerDocument.createRange();return h.setStart(this._,0),h.setEnd(this._,0),this._=s,{unitText:n,newLineOffsets:o,startMarker:e.Highlighter.surroundTextByTag(t.MarkerTagName,h,()=>!0,()=>{},this.V?[this.V]:[])}}return null}getNonIgnoredParentElement(e){let i=e.parentElement;for(;i&&!(t.IgnoreTagList.findIndex(e=>e===i.tagName.toLowerCase())<0);)i=i.parentElement;return i}}t.IgnoreTagList=["msnoun","msverb","msadjective","mssyllable","mark","msreadoutspan","msmarker"],t.MarkerTagName="msunitmarker",e.NLXUnitGenerator=t}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e.GetLinguisticModel="GetLinguisticModelByText",e.Meta=JSON.stringify({appId:"Edge"}),e.Version="2.0",e.LinguisticModelRequestSyllablesOptions=JSON.stringify({enableLanguageDetection:!0,returnWordSegments:!0,returnPartsOfSpeech:!1,returnSyllables:!0,returnLanguages:!0}),e.LinguisticModelRequestPOSOptions=JSON.stringify({enableLanguageDetection:!0,returnWordSegments:!0,returnPartsOfSpeech:!0,returnSyllables:!1,returnLanguages:!0})}(t=e.NLXRequestConsts||(e.NLXRequestConsts={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(t){t.parseJsonOrNull=function(t,i,s){if(!e.StringUtilties.isNullOrEmpty(t))try{return JSON.parse(t)}catch(e){s&&s.reportJsonParsingError(i)}return null}}(t=e.JsonUtilities||(e.JsonUtilities={}))}(LearningTools||(LearningTools={})),function(e){e.EmptyReleasable={release:()=>{}};e.ReleasableList=class{constructor(){this.S=[]}release(){if(void 0!==this.S){let e=this.S;this.S=void 0;for(let t=0;t<e.length;t++)e[t].release()}}add(e){this.S.push(e)}}}(LearningTools||(LearningTools={})),function(e){e.EventSource=class{constructor(){this.C=[]}subscribe(e){var t=!1,i=i=>{t||e(i)};return this.C.push(i),{release:()=>{t=!0;var e=this.C.indexOf(i);e>-1&&this.C.splice(e,1)}}}trigger(e){for(var t=this.C.slice(0),i=0;i<t.length;i++)t[i](e)}}}(LearningTools||(LearningTools={})),function(e){e.CancellationToken=class{constructor(){this.M=!1,this.k=new e.EventSource}cancel(){this.M||(this.M=!0,this.k.trigger(null))}isCancellationRequested(){return this.M}onCancelled(){return this.k}}}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.unprocessed=0]="unprocessed",e[e.processing=1]="processing",e[e.processed=2]="processed"}(t=e.ProcessingState||(e.ProcessingState={}));class i{constructor(s,n,o,r,h,a,l,u,d,c){this.processNLXResponse=(e=>{switch(e.responseType){case i.ComprehensionToolsDataResponse:this.processNLXDataResponse(e);break;case i.ComprehensionToolsCancellationResponse:this.processNLXCancellationResponse(e)}}),this.N=s,this.P=n,this.O=o,this.A=r,this.u=h,this.I=a,this.F=0,this.U=l,this.V=c,this.B=u,this.D=d,this.initializeComprehensionToolsRequestState(e.ComprehensionToolType.syllables),this.initializeComprehensionToolsRequestState(e.ComprehensionToolType.pos),this.q=null,this.H=t.unprocessed}static getColorIndex(t,i){switch(i){case e.ComprehensionToolType.nouns:return t.nounsColorIndex;case e.ComprehensionToolType.verbs:return t.verbsColorIndex;case e.ComprehensionToolType.adjectives:return t.adjectivesColorIndex;default:return}}static setColorIndex(t,i,s){switch(i){case e.ComprehensionToolType.nouns:t.nounsColorIndex=s;break;case e.ComprehensionToolType.verbs:t.verbsColorIndex=s;break;case e.ComprehensionToolType.adjectives:t.adjectivesColorIndex=s;break;default:return}}static AdjustColorIndexes(e,t,s){let n=i.getColorIndex(t,e),o=null,r=[n];if(i.POSList.forEach(s=>{if(s!==e){let e=i.getColorIndex(t,s);e===n?o=s:r.push(e)}}),o){let e=n;for(;r.indexOf(e)>=0;)e=(e+1)%s;i.setColorIndex(t,o,e)}}getDocumentId(){return this.P}markAsync(e,t){let i=this.getComprehensionRequestState(e);if(i.processingCancellationTokens.has(e)||t.isCancellationRequested())return Promise.reject("Invalid Request");{i.processingCancellationTokens.set(e,t);let s=t.onCancelled().subscribe(()=>{i.processingCancellationTokens.delete(e),0===i.processingCancellationTokens.size&&i.processingCancelled.trigger(void 0)});return this.processDocument(e).then(()=>(s.release(),i.processingCancellationTokens.delete(e),Promise.resolve()),()=>(s.release(),i.processingCancellationTokens.delete(e),Promise.reject("rejected promise")))}}setVisibility(t,s){let n;switch(s){case e.ComprehensionToolType.syllables:n=i.SyllablesActiveClass;break;case e.ComprehensionToolType.nouns:n=i.NounsActiveClass;break;case e.ComprehensionToolType.verbs:n=i.VerbsActiveClass;break;case e.ComprehensionToolType.adjectives:n=i.AdjectivesActiveClass}t?this.u.classList.add(n):this.u.classList.remove(n)}setLineMarkersVisibility(e){e?this.u.classList.add(i.LineMarkersActiveClass):this.u.classList.remove(i.LineMarkersActiveClass)}getProcessingState(e){return this.getComprehensionRequestState(e).processingState}getLanguageErrors(e){return this.getComprehensionRequestState(e).languageErrors}getFatalErrors(e){return this.getComprehensionRequestState(e).fatalError?{errorCode:-1,errorParameters:[this.getComprehensionRequestState(e).fatalError]}:null}setColor(e,i){this.getComprehensionRequestState(e).processingState===t.processed&&(this.q&&(this.q.release(),this.q=null),this.q=this.addColorStyles(i))}addLineMarkers(){this.H===e.ProcessingState.unprocessed&&(i.POSList.forEach(t=>{let s=this.j.releasableHighlights.get(t);for(let n=0;n<s.length;n++){let o,r=s[n].value(),h=s[n].value().find(t=>t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE&&!e.StringUtilties.isNullOrEmpty(t.firstChild.textContent));for(let t=0;t<r.length;t++)if(r[t].firstChild&&r[t].firstChild.nodeType===Node.TEXT_NODE&&!e.StringUtilties.isNullOrEmpty(r[t].firstChild.textContent)){h=r[t].firstChild;break}switch(t){case e.ComprehensionToolType.nouns:o=this.U.PartsOfSpeech_Nouns_LineMarkers;break;case e.ComprehensionToolType.verbs:o=this.U.PartsOfSpeech_Verbs_LineMarkers;break;case e.ComprehensionToolType.adjectives:o=this.U.PartsOfSpeech_Adjectives_LineMarkers;break;default:return}let a=this.N.createRange();a.setStart(h,0),a.setEnd(h,0);let l=new Map([["aria-hidden","true"],["data-label",o]]);e.Highlighter.surroundTextByTag(i.LineMarkerTag,a,()=>!0,()=>{},this.V?[this.V]:[],null,l)}}),this.H=t.processed)}addColorStyles(t){return i.POSList.forEach(s=>{let n;switch(s){case e.ComprehensionToolType.nouns:n=t.nounsColorIndex;break;case e.ComprehensionToolType.verbs:n=t.verbsColorIndex;break;case e.ComprehensionToolType.adjectives:n=t.adjectivesColorIndex;break;default:return}this.N.body.setAttribute(i.HighContrastPOSColorAttributes.get(s),n.toString());for(let t of this.D.values())this.N.body.style.setProperty(t.propertyName+"-"+e.ComprehensionToolType[s],t.colors[n])}),{release:()=>{i.POSList.forEach(t=>{this.N.body.removeAttribute(i.HighContrastPOSColorAttributes.get(t));for(let i of this.D.values())this.N.body.style.removeProperty(i.propertyName+"-"+e.ComprehensionToolType[t])})}}}initializeComprehensionToolsRequestState(i){let s={pendingUnits:new Map,processingState:t.unprocessed,languageErrors:new Map,fatalError:null,processingComplete:new e.EventSource,processingCancelled:new e.EventSource,processingPromise:null,processingCancellationTokens:new Map,releasableHighlights:new Map};i&e.ComprehensionToolType.syllables&&(this.J=s,this.J.releasableHighlights.set(e.ComprehensionToolType.syllables,[])),i&e.ComprehensionToolType.pos&&(this.j=s,this.j.releasableHighlights.set(e.ComprehensionToolType.nouns,[]),this.j.releasableHighlights.set(e.ComprehensionToolType.verbs,[]),this.j.releasableHighlights.set(e.ComprehensionToolType.adjectives,[]))}getComprehensionRequestState(t){return t&e.ComprehensionToolType.syllables?this.J:t&e.ComprehensionToolType.pos?this.j:null}createContextId(){return this.F++,this.O.toString()+this.F.toString()+Date.now().toString()}processDocument(e){let i=this.getComprehensionRequestState(e);if(i.processingState===t.unprocessed){i.processingState=t.processing;let s=new Promise((s,n)=>{if(0===i.processingCancellationTokens.size)n();else{let o,r=i.processingComplete.subscribe(e=>{i.processingState=e,r.release(),o.release(),s()});o=i.processingCancelled.subscribe(()=>{this.createAndSendNLXCancellationRequests(e),this.releaseComprehensionMarkers(e),i.languageErrors.clear(),i.fatalError=null,i.processingState=t.unprocessed,r.release(),o.release(),n()}),this.createAndSendNLXProcessingRequests(e)||(r.release(),o.release(),s())}});return i.processingPromise=s,s}return i.processingState===t.processing?i.processingPromise:Promise.resolve()}createAndSendNLXProcessingRequests(t){let s,n,o=!1,r=new e.NLXUnitGenerator(this.N,1200,this.V),h=this.getComprehensionRequestState(t);for(t&e.ComprehensionToolType.syllables?n=e.NLXRequestConsts.LinguisticModelRequestSyllablesOptions:t&e.ComprehensionToolType.pos&&(n=e.NLXRequestConsts.LinguisticModelRequestPOSOptions),r.setStartingElementNode(this.u);s=r.getNextNLXUnit();){let t=this.createContextId(),r=JSON.stringify({text:s.unitText,langs:[{t:this.A,l:s.unitText.length,o:0}]}),a={contextId:t,requestType:i.ComprehensionToolsProcessingRequest,metaJson:e.NLXRequestConsts.Meta,action:e.NLXRequestConsts.GetLinguisticModel,version:e.NLXRequestConsts.Version,optionsJson:n,dataJson:r};h.pendingUnits.set(t,{startMarker:s.startMarker,newLineOffsets:s.newLineOffsets}),this.I.processNLXRequest(a,this.processNLXResponse),o=!0}return o}createAndSendNLXCancellationRequests(e){let t=this.getComprehensionRequestState(e);for(let e of t.pendingUnits.keys()){let s={contextId:e,requestType:i.ComprehensionToolsCancellationRequest};this.I.processNLXRequest(s),t.pendingUnits.get(e).startMarker.release(),t.pendingUnits.delete(e)}}processNLXDataResponse(i){let s,n,o,r;this.J.pendingUnits.has(i.contextId)?(s=e.ComprehensionToolType.syllables,o=((e,t)=>this.addSyllableMarkers(e,t))):this.j.pendingUnits.has(i.contextId)&&(s=e.ComprehensionToolType.pos,o=((e,t)=>this.addPOSMarkers(e,t))),r=(n=this.getComprehensionRequestState(s)).pendingUnits.get(i.contextId);let h=e.JsonUtilities.parseJsonOrNull(i.dataJson,"NLXResponseData",this.B);h?(o(r,h),this.addLanguageErrors(h.langSummary,s)):i.errorJson&&(n.fatalError=i.errorJson),r.startMarker.release(),n.pendingUnits.delete(i.contextId),0===n.pendingUnits.size&&n.processingComplete.trigger(t.processed)}processNLXCancellationResponse(i){let s,n;this.J.pendingUnits.has(i.contextId)?s=e.ComprehensionToolType.syllables:this.j.pendingUnits.has(i.contextId)&&(s=e.ComprehensionToolType.pos),(n=this.getComprehensionRequestState(s)).pendingUnits.get(i.contextId).startMarker.release(),n.pendingUnits.delete(i.contextId),0===n.pendingUnits.size&&n.processingComplete.trigger(t.unprocessed),this.releaseComprehensionMarkers(s)}addSyllableMarkers(t,s){if(s){let n=e.TreeNodeWalker.createTreeTextNodeWalker(this.u),o=0,r=t.newLineOffsets,h=0;n.currentNode=t.startMarker.value()[0],n.nextNode();for(let t=0;t<s.sy.length;t++){let a=s.sy[t],l=a.w,u=s.wo[l].o;for(let t=0;t<a.s.length;t++){let s=a.s[t]+u;for(;h<r.length&&r[h]<s+1;)h++;let l=s-(o+=e.TreeNodeWalker.moveByTextOffset(n,s-o-h+1))-h+1,d=this.createRangeAndHighlight(n,i.SyllableTag,n.currentNode,l,n.currentNode,l);o+=l,this.J.releasableHighlights.get(e.ComprehensionToolType.syllables).push(d)}}}}addPOSMarkers(t,s){if(s){let n=e.TreeNodeWalker.createTreeTextNodeWalker(this.u),o=0,r=t.newLineOffsets,h=0;n.currentNode=t.startMarker.value()[0],n.nextNode();for(let t=0;t<s.pos.length;t++){let a=s.pos[t],l=a.w,u=s.wo[l],d=u.o,c=d+u.l;for(;h<r.length&&r[h]<d;)h++;let g=d-(o+=e.TreeNodeWalker.moveByTextOffset(n,d-o-h))-h,m=n.currentNode;for(;h<r.length&&r[h]<c;)h++;let f,w,L,v=c-(o+=e.TreeNodeWalker.moveByTextOffset(n,c-o-h))-h,T=n.currentNode;switch(a.t){case 1:f=i.NounTag,w=this.U.PartsOfSpeech_Noun,L=this.j.releasableHighlights.get(e.ComprehensionToolType.nouns);break;case 2:f=i.AdjectiveTag,w=this.U.PartsOfSpeech_Adjective,L=this.j.releasableHighlights.get(e.ComprehensionToolType.adjectives);break;case 3:f=i.VerbTag,w=this.U.PartsOfSpeech_Verb,L=this.j.releasableHighlights.get(e.ComprehensionToolType.verbs)}let p=this.createRangeAndHighlight(n,f,m,g,T,v,w);o+=v,L.push(p)}}}createRangeAndHighlight(t,i,s,n,o,r,h){let a=this.N.createRange();a.setStart(s,n),a.setEnd(o,r);let l=h?new Map([["data-label",h]]):null;return e.Highlighter.surroundTextByTag(i,a,t=>e.StringUtilties.NONEMPTY_STRING_REGEX.test(t.textContent),(e,i)=>{t.currentNode=i[i.length-1]},this.V?[this.V]:[],null,l)}addLanguageErrors(t,i){let s;i&e.ComprehensionToolType.syllables?s=(e=>e.support.syllables):i&e.ComprehensionToolType.pos&&(s=(e=>e.support.partsOfSpeech));let n=this.getComprehensionRequestState(i).languageErrors;t.forEach(t=>{let i=s(t);i!==e.LanguageStatus.NotSupported&&i!==e.LanguageStatus.Supported_NotInstalled||(n.has(i)?n.get(i).add(t.id):n.set(i,new Set([t.id])))})}releaseComprehensionMarkers(e){let t=this.getComprehensionRequestState(e);for(let e of t.releasableHighlights.keys())t.releasableHighlights.get(e).forEach(e=>{e.release()}),t.releasableHighlights.set(e,[])}}i.ComprehensionToolsDataResponse="LinguisticModelResponse",i.ComprehensionToolsCancellationResponse="OperationCancelled",i.ComprehensionToolsProcessingRequest="GetLinguisticModel",i.ComprehensionToolsCancellationRequest="CancelOperation",i.SyllablesActiveClass="ms-syllables-active",i.NounsActiveClass="ms-nouns-active",i.VerbsActiveClass="ms-verbs-active",i.AdjectivesActiveClass="ms-adjectives-active",i.LineMarkersActiveClass="ms-linemarkers-active",i.SyllableTag="mssyllable",i.NounTag="msnoun",i.VerbTag="msverb",i.AdjectiveTag="msadjective",i.LineMarkerTag="mslinemarker",i.HighContrastPOSColorAttributes=new Map([[e.ComprehensionToolType.nouns,"color-index-nouns"],[e.ComprehensionToolType.verbs,"color-index-verbs"],[e.ComprehensionToolType.adjectives,"color-index-adjectives"]]),i.POSList=[e.ComprehensionToolType.nouns,e.ComprehensionToolType.verbs,e.ComprehensionToolType.adjectives],e.DocumentComprehensionTools=i}(LearningTools||(LearningTools={})),function(e){e.NLXAppProxy=class{constructor(e,t){this.processNLXResponse=(e=>{if(this.W.has(e.contextId)){let t=this.W.get(e.contextId);t&&t(e),this.W.delete(e.contextId)}}),this.X=e,this.W=new Map,t.subscribe(this.processNLXResponse)}processNLXRequest(e,t){this.W.set(e.contextId,t||null),this.X(e)}}}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.Word=1]="Word",e[e.Line=2]="Line",e[e.Background=4]="Background",e[e.All=7]="All",e[e.ExceptWord=6]="ExceptWord",e[e.WordAndLine=3]="WordAndLine"}(t=e.DecorationType||(e.DecorationType={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.Selection=0]="Selection",e[e.Scrolling=1]="Scrolling"}(t=e.UserActionType||(e.UserActionType={}))}(LearningTools||(LearningTools={})),function(e){e.ReadingNavigator=class{}}(LearningTools||(LearningTools={})),function(e){let t;!function(t){function i(e,t){var s=t;if(e.endContainer.nodeType===Node.TEXT_NODE){let t=e.endContainer.textContent.length;if(e.endOffset<t&&!h(e.endContainer)){let i=Math.min(e.endOffset+s,t);s-=i-e.endOffset,e.setEnd(e.endContainer,i)}}if(s>0){let t=e.endContainer.nodeType===Node.ELEMENT_NODE?e.endContainer.childNodes[e.endOffset-1]:e.endContainer,i=o(t.ownerDocument.body,t);if(i&&!h(i)){let t=Math.min(s,i.textContent.length);s-=t,e.setEnd(i,t)}}var n=s<t;return n&&s>0&&i(e,s),n}function s(e,t){var i=t;if(e.startContainer.nodeType===Node.TEXT_NODE&&e.startOffset>0&&!h(e.startContainer)){let t=Math.max(0,e.startOffset-i);i-=e.startOffset-t,e.setStart(e.startContainer,t)}if(i>0){let t=e.startContainer.nodeType===Node.ELEMENT_NODE?e.startContainer.childNodes[e.startOffset]:e.startContainer,s=n(t.ownerDocument.body,t);if(s&&!h(s)){let t=s.textContent.length,n=Math.max(0,t-i);i-=t-n,e.setStart(s,n)}}var o=i<t;return o&&i>0&&s(e,i),o}function n(t,i){let s=i;do{s=e.ReadingUnitNavigator.shouldSkipNode(s)?e.ReadingUnitNavigator.getPreviousSubtreeNode(t,s):e.ReadingUnitNavigator.getPreviousReadingNode(t,s)}while(s&&(s.nodeType!==Node.TEXT_NODE||h(s)));return s!==i?s:null}function o(t,i){let s=i;do{s=e.ReadingUnitNavigator.shouldSkipNode(s)?e.ReadingUnitNavigator.getNextSubtreeNode(t,s):e.ReadingUnitNavigator.getNextReadingNode(t,s)}while(s&&(s.nodeType!==Node.TEXT_NODE||h(s)));return s!==i?s:null}function r(e){if(1===e.length)return 0===e.item(0).top&&0===e.item(0).bottom&&0===e.item(0).left&&0===e.item(0).right;if(e.length>1){var t=e.item(0).top,i=e.item(0).bottom;for(let s=1;s<e.length;s++)if(e.item(s).top!==t||e.item(s).bottom!==i)return!0}return!1}function h(t){var i=t.textContent;return 0===i.length||!e.StringUtilties.NONEMPTY_STRING_REGEX.test(i)}t.createRange=function(e,t,i){for(var s,n=e.textNodes,o=n.length,r=t,h=0;h<o&&r>=n[h].length;)r-=n[h].length,h++;var a=s=h;if(a===o)return null;let l=n[a].length-r;if(i>l){for(i-=l,a++;a<o&&i>n[a].length;)i-=n[a].length,a++;if(a>=o)return null}else i+=r;var u=n[0].ownerDocument;if(u.contains(n[s])&&u.contains(n[a])){let e=u.createRange();return e.setStart(n[s],r),e.setEnd(n[a],i),e}return null},t.expandRangeEnd=i,t.expandRangeStart=s,t.expandToLineRange=function(e,t){let n=e.cloneRange();return function(e,t){let i=e.startContainer,n=e.startOffset;[10,1].forEach(o=>{for(;s(e,o);){var h=t(e);if(0===h.length||r(h))break;i=e.startContainer,n=e.startOffset}e.setStart(i,n)})}(n,t),function(e,t){let s=e.endContainer,n=e.endOffset;[10,1].forEach(o=>{for(;i(e,o);){var h=t(e);if(0===h.length||r(h))break;s=e.endContainer,n=e.endOffset}e.setEnd(s,n)})}(n,t),n},t.getPreviousExpandableNode=n,t.getNextExpandableNode=o}(t=e.ReadingRangeManipulations||(e.ReadingRangeManipulations={}))}(LearningTools||(LearningTools={})),function(e){class t{constructor(t,i){this.B=i,this.G=[],this.K=null,this.Y=e.JsonUtilities.parseJsonOrNull(t,"ReadOutLoudSpeechPreferences",this.B),this.Z=1,this.$=null,this.ee=!0,this.te=new e.EventSource,this.ie=new e.EventSource,this.se=new e.EventSource,this.ne=new e.EventSource,this.oe=new e.EventSource,this.setSpeechSynthesis(window.speechSynthesis)}setSpeechSynthesis(e){this.re=e,this.refreshVoicesList()}getSpeechSynthesis(){return this.re}getSpeechPreferences(){return this.Y}setReadingRate(e){this.Z!==e&&(this.Z=e,this.ie.trigger(void 0),this.updateSpeechPreferences())}getReadingRate(){return this.Z}setCurrentVoiceFromURI(e){var t=this.G.find(t=>t.voiceURI===e);t&&this.$!==t&&(this.$=t,this.se.trigger(void 0),this.updateSpeechPreferences())}getVoice(){return this.$}getDropDownOptionsForVoices(){return this.K}setCompatibleVoiceAvailable(e){this.ee=e,this.ne.trigger(void 0)}getCompatibleVoiceAvailable(){return this.ee}voiceChanged(){return this.se}rateChanged(){return this.ie}compatibleVoiceAvailableChanged(){return this.ne}voicesChanged(){return this.te}speechPreferencesChanged(){return this.oe}ensureSpeechSettingsInitialized(e){if(this.A=e,!this.$){if(this.refreshVoicesList(),!(this.G&&this.G.length>0))return this.B.reportReadOutLoudInternalError("ReadOutLoudSettingsViewModel_ensureSpeechSettingsInitialized_noLanguagePackageInstalled"),this.ne.trigger(void 0),!1;if(!this.setSpeechSettingsForLanguage(e)&&(e=e.split("-")[0],!this.setSpeechSettingsForLanguage(e)))return this.$=this.G[0],this.se.trigger(void 0),this.B.reportReadOutLoudInternalError("ReadOutLoudSettingsViewModel_ensureSpeechSettingsInitialized_languagePackageNotFound"),this.ee=!1,this.ne.trigger(void 0),!1;this.ee=!0,this.ne.trigger(void 0)}return!0}setSpeechSettingsForLanguage(e){var t=null,i=null;if(this.Y&&this.Y.languageSettings&&this.Y.languageSettings.length>0){var s=this.Y.languageSettings.find(t=>0===t.language.toUpperCase().indexOf(e.toUpperCase()));s&&(t=this.G.find(e=>e.voiceURI.toUpperCase()===s.voiceURI.toUpperCase()),i=s.rate>=.5&&s.rate<=2?s.rate:1)}return t||(t=this.G.find(t=>0===t.lang.toUpperCase().indexOf(e.toUpperCase())),i=1),!(!t||!i)&&(this.$=t,this.se.trigger(void 0),this.Z=i,this.ie.trigger(void 0),!0)}updateSpeechPreferences(){this.A&&this.A.length<=t.MaxLanguageLength&&(this.Y={languageSettings:[{language:this.A,voiceURI:this.$.voiceURI,rate:this.Z}]},this.oe.trigger(JSON.stringify(this.Y)))}refreshVoicesList(){this.G=this.re.getVoices(),this.G&&this.G.length>0&&(this.K=this.G.map(e=>({uri:e.voiceURI,name:e.name}))),this.te.trigger(void 0)}}t.MaxLanguageLength=85,e.ReadOutLoudSettingsViewModel=t}(LearningTools||(LearningTools={})),function(e){let t,i;!function(e){e[e.InEligible=0]="InEligible",e[e.Playing=1]="Playing",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped",e[e.PlayDisabled=4]="PlayDisabled",e[e.InteractionsDisabled=5]="InteractionsDisabled",e[e.Uninitialized=6]="Uninitialized"}(t=e.ReadingState||(e.ReadingState={})),function(e){e[e.Current=2]="Current"}(i=e.UnitDirection||(e.UnitDirection={})),e.seekToStartTimeout=5e3,e.maxUtteranceLength=1e3;e.ReadOutLoudViewModel=class{constructor(e,s,n,o){this.he=e,this.ae=s,this.le=null,this.ue=[],this.de=!0,this.ce=!1,this.B=o,this.ge=!1,this.me=!1,n&&(this.fe=n,this.fe.voiceChanged().subscribe(()=>{this.getReadingState()!==t.Playing&&this.getReadingState()!==t.Paused||(this.cancelReading(!1),this.continueReading(i.Current))}),this.fe.rateChanged().subscribe(()=>{this.getReadingState()!==t.Playing&&this.getReadingState()!==t.Paused||(this.cancelReading(!1),this.continueReading(i.Current))}))}onUserActionStarted(){this.me||this.getReadingState()!==t.Playing||(this.ge=!0,this.pauseReading())}onUserActionCompleted(){!this.me&&this.ge&&this.startReading()}startReading(){this.ensureSpeechSynthesis(),this.ensureDelimiters();var s=this.getReadingState(),n=this.ue.length,o=s===t.Paused&&0===n;if(this.ce||n>0&&!this.re.paused)this.B.reportReadOutLoudInternalError("ReadOutLoudViewModel_startReading_ignored");else{var r=s===t.Paused&&this.isReadingPositionValid();r&&(this.ensureNavigationEventListeners(),this.re.resume());var h=!r&&s===t.Paused;if(!this.ce&&(s===t.Stopped||s===t.Uninitialized||o||h)){if(!this.fe.ensureSpeechSettingsInitialized(this.getLanguage())&&!o)return void this.pauseReading();h&&(this.cancelReading(!0),this.ae.deactivateDecoration(e.DecorationType.Word)),this.ensureNavigationEventListeners(),this.continueReading(i.Next,!0),this.re.paused&&this.re.resume()}}}pauseReading(){this.getReadingState()!==t.Paused&&(this.re&&this.re.pause(),this.ae.deactivateDecoration(e.DecorationType.ExceptWord),this.setReadingState(t.Paused))}stopReading(){this.cancelReading(!0,t.Stopped),this.we&&(this.we.release(),this.we=null),this.Le&&(this.Le.release(),this.Le=null)}moveToPreviousUnit(){if(this.getReadingState()===t.Playing){this.cancelReading(!1),this.he.setCurrentUnitTextOffset(0),this.de?this.continueReading(i.Current):this.continueReading(i.Previous),this.de=!1;var s=setTimeout(()=>{this.de=!0,this.ve=null},e.seekToStartTimeout);this.ve={release:()=>{clearTimeout(s)}}}}moveToNextUnit(){this.getReadingState()===t.Playing&&(this.cancelReading(!1),this.continueReading(i.Next))}settingsViewModel(){return this.fe}continueReading(e,s){this.ce||(this.ce=!0,(s?this.he.initializeAsync():Promise.resolve(!0)).then(s=>{if(!s||!this.ce)return this.cancelReading(!0,t.Stopped),this.B.reportReadOutLoudInternalError("ReadOutLoudViewModel_readingNavigator_initializeFailed"),!1;switch(e){case i.Previous:return this.he.moveToPreviousUnitAsync();case i.Next:return this.he.moveToNextUnitAsync();case i.Current:return!0}}).then(i=>{if(this.ce)if(i){let t=this.createSpeechUtterances(this.he.getCurrentUnit());t&&t.length>0?(t.forEach(e=>{this.re.speak(e)}),this.ce=!1):(this.ce=!1,this.continueReading(e,!1))}else this.cancelReading(!0,t.Paused),this.B.reportReadOutLoudInternalError("ReadOutLoudViewModel_readingNavigator_contentNotAvailable")}))}cancelReading(i,s){this.re.cancel(),this.ue.forEach(e=>e.release()),this.ue=[],i&&this.he.reset(),this.ve&&(this.ve.release(),this.ve=null),s&&(this.setReadingState(s),s===t.Stopped?this.ae.deactivateDecoration(e.DecorationType.All):s===t.Paused&&this.ae.deactivateDecoration(e.DecorationType.ExceptWord)),this.ce=!1}createSpeechUtterances(t){var i=[],s=t.textNodes.map(e=>e.textContent),n=(e.StringUtilties.skipText(s,t.textOffset),e.StringUtilties.adjustTextByLength(s,e.maxUtteranceLength,this.le)),o=t.textOffset;return n.forEach(e=>{i.push(this.createSpeechUtterance(t,e,o)),o+=e.length}),i}createSpeechUtterance(s,n,o){var r,h=new SpeechSynthesisUtterance;h.voice=this.fe.getVoice(),h.rate=this.fe.getReadingRate(),h.lang=this.fe.getVoice().lang,h.text="TH-TH"===h.lang.toUpperCase()?n:e.StringUtilties.replaceLinebreaksWithSpaces(n);let a=i=>{this.ae.activateDecoration(e.DecorationType.Background),this.setReadingState(t.Playing),this.ge=!1},l=e=>{if(this.de=!0,this.ve&&(this.ve.release(),this.ve=null),r){var s=this.ue.findIndex(e=>e===r);s>=0&&this.ue.splice(s,1),r.release(),r=null}this.getReadingState()===t.Playing&&0===this.ue.length&&this.continueReading(i.Next)},u=e=>{this.cancelReading(!0,t.Paused),this.B.reportReadOutLoudInternalError("ReadOutLoudViewModel_createSpeechUtterance_utteranceErrorHandler")},d=i=>{this.getReadingState()===t.Playing&&"word"===i.name&&(this.me=!0,this.ae.setWordDecorationPosition(s,o,i),this.ae.activateDecoration(e.DecorationType.WordAndLine),this.me=!1,this.he.setCurrentUnitTextOffset(o+i.charIndex))};return h.addEventListener("start",a),h.addEventListener("end",l),h.addEventListener("resume",a),h.addEventListener("error",u),h.addEventListener("boundary",d),r={value:()=>h,release:()=>{h.removeEventListener("start",a),h.removeEventListener("end",l),h.removeEventListener("resume",a),h.removeEventListener("error",u),h.removeEventListener("boundary",d)}},this.ue.push(r),r.value()}ensureNavigationEventListeners(){this.we||(this.we=this.addUserActionStartedListener(this)),this.Le||(this.Le=this.addUserActionCompletedListener(this))}ensureSpeechSynthesis(){this.re||(this.re=this.fe.getSpeechSynthesis())}ensureDelimiters(){this.le||(this.le=0===this.getLanguage().indexOf("en")?[".",";",","]:[".","。",";",","," ","-"])}}}(LearningTools||(LearningTools={})),function(e){let t,i;!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(t||(t={})),function(e){e[e.Next=0]="Next",e[e.Previous=1]="Previous"}(i||(i={}));class s{constructor(){this.Te=null,this.pe=null,this.T=null,this.p=null,this.be=!1,this.Re=!1,this.Ve=new e.EventSource,this._e=i.Next}setCurrentPosition(t){this.T=t.startContainer.ownerDocument,this.p=this.T.createTreeWalker(this.T.body,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:t=>(t.nodeType!==Node.TEXT_NODE||e.StringUtilties.NONEMPTY_STRING_REGEX.test(t.textContent))&&(t.nodeType!==Node.ELEMENT_NODE||this.isNonSplitableNode(t))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),this.initializeAnchorNodes(t)}setTargetHeight(e){this.Se=e}moveToNextUnit(){this._e!==i.Next&&this.getCurrentUnit(!0);let e=!1;this.p.currentNode=this.pe.value();let s=this.p.nextNode();if(s){let i=this.insertAnchorNode(s);if(this.releaseAnchorNodes(),this.Te=i,this.p.currentNode=this.Te.value(),s=this.p.nextNode()){let i=this.createLineFocusRangeFrom(s);this.pe=this.insertAnchorNode(i,t.End),e=this.Te.value().nextSibling!==this.pe.value()}}return this._e=i.Next,this.updateCanMove(),e}moveToPreviousUnit(){let e=!1;this.p.currentNode=this.Te.value();let s=this.p.previousNode();if(s){let i=this.getNonSplitableAncestorNode(s),n=this.T.createRange();n.selectNode(i||s);let o=this.insertAnchorNode(n,t.End);if(this.releaseAnchorNodes(),this.pe=o,this.p.currentNode=this.pe.value(),s=this.p.previousNode()){let i=this.createLineFocusRangeTo(s);this.Te=this.insertAnchorNode(i,t.Start),e=this.Te.value().nextSibling!==this.pe.value()}}return this._e=i.Previous,this.updateCanMove(),e}getCurrentUnit(e){let i=null;if(this.Te&&this.pe){this.p.currentNode=this.Te.value();let s=this.p.nextNode();if(s)if(this.isNonSplitableNode(s))i=s.getBoundingClientRect();else{let n=null;if(e){n=this.createLineFocusRangeFrom(this.p.currentNode);let e=this.insertAnchorNode(n,t.End);this.pe.release(),this.pe=e}(n=this.T.createRange()).selectNode(s),n.setEndBefore(this.pe.value()),i=n.getBoundingClientRect()}}return this.updateCanMove(),i}canMoveNext(){return this.be}canMovePrevious(){return this.Re}reset(){this.releaseAnchorNodes(),this.T=null,this.p=null,this.Se=0,this.be=!1,this.Re=!1,this._e=i.Next}insertAnchorNode(e,i){let s=this.T.createElement("hr");if(s.style.display="none",void 0!==i){let n=e.cloneRange();n.collapse(i===t.Start),n.surroundContents(s)}else e.parentElement.insertBefore(s,e);return{value:()=>s,release:()=>{let e=s.parentNode;e.removeChild(s),e.normalize()}}}createLineFocusRangeFrom(e){let t=e.ownerDocument.createRange();if(t.selectNode(e),this.isNonSplitableNode(e))return t;this.p.currentNode=e;let i=e,s=null;for(;i;){if(this.isNonSplitableNode(i))return t;if(t.setEndAfter(i),t.getBoundingClientRect().height>this.Se)break;s=i,i=this.p.nextNode()}if(i&&i.nodeType===Node.TEXT_NODE){let e=0,n=i.textContent.length;for(;e<n;){let s=Math.floor(e+(n-e)/2);t.setEnd(i,s);t.getBoundingClientRect().height;t.getBoundingClientRect().height>this.Se?n=s:e=s+1}n>0?(t.setEnd(i,n),t.getBoundingClientRect().height>this.Se&&t.setEnd(i,n-1)):t.setEndAfter(s||i)}return t}createLineFocusRangeTo(e){let t=this.getNonSplitableAncestorNode(e),i=e.ownerDocument.createRange();if(t)return i.selectNode(t),i;i.selectNode(e),this.p.currentNode=e;let s=e,n=null;for(;s;){if(t=this.getNonSplitableAncestorNode(s))return i;if(i.setStartBefore(s),i.getBoundingClientRect().height>this.Se)break;n=s,s=this.p.previousNode()}if(s&&s.nodeType===Node.TEXT_NODE){let e=0,t=s.textContent.length;for(;e<t;){let n=Math.floor(e+(t-e)/2);i.setStart(s,n),i.getBoundingClientRect().height>this.Se?e=n+1:t=n}t<s.textContent.length?i.setStart(s,t):i.setStartBefore(n||s)}return i}initializeAnchorNodes(e){let i,s=this.getNonSplitableAncestorNode(e.startContainer);if(s)i=this.insertAnchorNode(s);else{i=this.insertAnchorNode(e,t.Start),this.p.currentNode=i.value();let s=this.p.nextNode();s&&i.value().nextSibling!==s&&(i.release(),i=this.insertAnchorNode(s))}this.releaseAnchorNodes(),this.pe=i,this.Te=this.insertAnchorNode(this.pe.value()),this.updateCanMove()}releaseAnchorNodes(){this.Te&&this.Te.release(),this.pe&&this.pe.release(),this.Te=null,this.pe=null}isNonSplitableNode(e){return e&&e.nodeType===Node.ELEMENT_NODE&&s.NonSplitableNodeList.indexOf(e.tagName)>-1}getNonSplitableAncestorNode(e){for(;e&&!this.isNonSplitableNode(e);)e=e.parentNode;return e}updateCanMove(){let e=!1;this.Te&&(this.p.currentNode=this.Te.value(),e=null!==this.p.previousNode());let t=!1;this.pe&&(this.p.currentNode=this.pe.value(),t=null!==this.p.nextNode()),this.be===t&&this.Re===e||(this.be=t,this.Re=e,this.Ve.trigger(void 0))}}s.NonSplitableNodeList=["TABLE","SVG","IMG","VIDEO","OBJECT","AUDIO","EMBED","MAP","IFRAME"],e.LineFocusUnitProvider=s}(LearningTools||(LearningTools={})),function(e){e.LineFocusLineCount="LineFocus_LineCount"}(LearningTools||(LearningTools={})),function(e){class t{constructor(i,s,n,o,r){this.Ce=i,this.Me=s,this.ke=n,this.fe=o,this.B=r,this.Ne=!1,this.ye=this.fe?this.fe.getSetting(e.LineFocusLineCount):t.LineCount[0],this.xe=this.calculateMaxLineCount(),this.Pe=!1,this.S=[],this.Oe=!1,this.Ae=new e.EventSource,this.Ee=new e.EventSource,this.Ie=new e.EventSource}getCurrentLineCount(){return this.ye}getMaxLineCount(){return this.xe}enterLineFocusMode(e){this.Ne=!0,this.Fe=e,this.Ce.enterLineFocusMode();let t=this.Me.getDocumentStartRange();t.collapse(!0),this.ke.setCurrentPosition(t),this.ke.setTargetHeight(this.getCurrentTextViewHeightWithMargin()),this.moveToNextUnit(),this.S.push(this.Ce.onLayoutChanged().subscribe(()=>this.onLayoutChanged())),this.S.push(this.Ce.onWheel().subscribe(e=>this.onWheel(e))),this.S.push(this.Ce.onKeyDown().subscribe(e=>this.onKeyDown(e))),this.S.push(this.Me.onScrollEnd().subscribe(e=>this.onScrollEnd(e))),this.B.reportLineFocusState(this.Fe,this.Ne),this.Ae.trigger(this.Ne)}exitLineFocusMode(){this.Ne=!1,this.ke.reset(),this.Ce.exitLineFocusMode(),this.Pe=!1,this.S.forEach(e=>e.release()),this.B.reportLineFocusState(this.Fe,this.Ne),this.Fe=null,this.Ae.trigger(this.Ne)}moveToNext(){if(!this.Pe){if(this.Oe)return this.refreshCurrentPosition(!0);let e,t=this.Ce.getLineFocusViewRect(),i=this.ke.getCurrentUnit().bottom-t.bottom;return i>2?(e=i>t.height?{top:t.bottom,left:t.left,bottom:t.bottom+t.height,right:t.right,height:t.height,width:t.width}:{top:t.top+i,left:t.left,bottom:t.bottom+i,right:t.right,height:t.height,width:t.width},this.processBringRectIntoView(e,!0)):this.moveToNextUnit()}}moveToPrevious(){if(!this.Pe){if(this.Oe)return this.refreshCurrentPosition(!1);let e,t=this.Ce.getLineFocusViewRect(),i=this.ke.getCurrentUnit(),s=t.top-i.top;return s>2?(e=s>t.height?{top:t.top-t.height,left:t.left,bottom:t.top,right:t.right,height:t.height,width:t.width}:{top:t.top-s,left:t.left,bottom:t.bottom-s,right:t.right,height:t.height,width:t.width},this.processBringRectIntoView(e,!0)):this.moveToPreviousUnit()}}setLineCount(i){t.LineCount.indexOf(i)>-1&&(this.ye=i,this.onLayoutChanged(),this.fe&&this.fe.setSetting(e.LineFocusLineCount,this.ye),this.Ee.trigger(this.ye))}onLineFocusStateChanged(){return this.Ae}onLineCountChanged(){return this.Ee}onMaxLineCountChanged(){return this.Ie}overrideIsBringingInView(){this.Pe=!1}moveToNextUnit(){let e={top:0,left:0,bottom:0,right:0,height:0,width:0};for(;e.height<t.MinUnitHeight||e.width<t.MinUnitWidth;){if(!this.ke.moveToNextUnit())return Promise.resolve(!1);e=this.ke.getCurrentUnit()}return this.Ce.setLineFocusViewHeight(Math.max(e.height,this.getCurrentTextViewHeight())),this.processBringRectIntoView(e,!0)}moveToPreviousUnit(){let e=!0,i={top:0,left:0,bottom:0,right:0,height:0,width:0};for(;i.height<t.MinUnitHeight||i.width<t.MinUnitWidth;){if(!this.ke.moveToPreviousUnit())return Promise.resolve(!1);i=this.ke.getCurrentUnit()}let s=this.getCurrentTextViewHeight();return i.height>s?(this.Ce.setLineFocusViewHeight(i.height),e=!1):this.Ce.setLineFocusViewHeight(s),this.processBringRectIntoView(i,e)}refreshCurrentPosition(e){this.Oe=!1;let t=this.Me.getStartingPosition();return t.collapse(!0),this.ke.setCurrentPosition(t),this.ke.setTargetHeight(this.getCurrentTextViewHeightWithMargin()),e?this.moveToNextUnit():this.moveToPreviousUnit()}onLayoutChanged(){setTimeout(()=>{this.adjustLineCount(),this.ke.setTargetHeight(this.getCurrentTextViewHeightWithMargin());let e=this.ke.getCurrentUnit(!0);this.Ce.setLineFocusViewHeight(Math.max(e.height,this.getCurrentTextViewHeight())),this.Ce.bringRectIntoLineFocusView(e,!0).then(()=>this.Oe=!1)},0)}adjustLineCount(){let t=this.xe;this.xe=this.calculateMaxLineCount(),t!==this.xe&&this.Ie.trigger(this.xe),this.ye>this.xe&&(this.ye=this.xe,this.fe&&this.fe.setSetting(e.LineFocusLineCount,this.ye),this.Ee.trigger(this.ye))}calculateMaxLineCount(){for(let e=t.LineCount.length-1;e>0;e--){if(t.LineCount[e]*this.Ce.getBaseLineHeight()-this.Ce.getLineFocusViewMargins()<this.Ce.getMaxLineFocusViewHeight())return t.LineCount[e]}return t.LineCount[0]}getCurrentTextViewHeight(){return this.ye*this.Ce.getBaseLineHeight()-this.Ce.getLineFocusViewMargins()}getCurrentTextViewHeightWithMargin(){return this.ye*this.Ce.getBaseLineHeight()}processBringRectIntoView(e,t){return this.Pe=!0,this.Ce.bringRectIntoLineFocusView(e,t).then(e=>(this.Pe=!1,!0))}onScrollEnd(t){t!==e.ScrollSource.LineFocus&&(this.Oe=!0)}onWheel(e){e.preventDefault(),e.deltaY>0?this.moveToNext():e.deltaY<0&&this.moveToPrevious()}onKeyDown(e){switch(e.key){case"ArrowDown":this.moveToNext();break;case"ArrowUp":this.moveToPrevious();break;case"Escape":e.preventDefault(),this.exitLineFocusMode();break;case"PageUp":case"PageDown":case"End":case"Home":e.preventDefault(),e.stopPropagation()}}}t.LineCount=[1,3,5],t.MinUnitHeight=2,t.MinUnitWidth=2,e.LineFocus=t}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e[e.ReadAloud=0]="ReadAloud",e[e.LineFocus=1]="LineFocus",e[e.Unknown=2]="Unknown"}(t=e.ScrollSource||(e.ScrollSource={}))}(LearningTools||(LearningTools={})),function(e){let t;!function(e){e.getTextNodeFromPoint=function(e,t,i,s){var n=e.elementFromPoint(t,i);if(n){var o=e.createTreeWalker(e.body,NodeFilter.SHOW_TEXT);o.currentNode=n;for(var r=o.nextNode(),h=e.createRange();r;){if(h.selectNode(r),s(h).bottom>i)return r;r=o.nextNode()}}return null},e.getRangeAfterYPositionOrDefault=function(e,t,i,s){for(var n,o=e.createRange(),r=0,h=t.textContent.length;r!==h;)n=Math.floor(r+(h-r)/2),o.setStart(t,n),o.collapse(!0),s(o).bottom>i?h=n:r=n+1;return o.setStart(t,r),o.collapse(!0),o},e.addReleasableDomEventListener=function(e,t,i){return e.addEventListener(t,i),{release:()=>{e.removeEventListener(t,i)}}}}(t=e.DomUtilties||(e.DomUtilties={}))}(LearningTools||(LearningTools={})),function(e){class t{constructor(t){this.Ue=t,this.Be=new e.EventSource,this.De=new e.EventSource,this.qe=new e.EventSource,this.He=new e.EventSource,this.je=new e.EventSource,this.Je=new e.EventSource,this.ze=new e.EventSource,this.We=new e.EventSource,this.Xe=new e.EventSource,this.B=new e.TelemetryClient(this),this.Ue.onMessageFromHost.addListener(e=>{this.onMessageFromHost(e)})}readOutLoudSwitchScopeRequested(){return this.Be}readOutLoudStartRequested(){return this.De}readOutLoudStopRequested(){return this.qe}readOutLoudPauseRequested(){return this.He}readOutLoudResumeRequested(){return this.je}readOutLoudNextRequested(){return this.Je}readOutLoudPreviousRequested(){return this.ze}readOutLoudChangeVoiceRequested(){return this.Xe}readOutLoudChangeRateRequested(){return this.We}sendSpeechPreferences(e){this.postMessageToHost(t.ReadOutLoudSpeechPreferencesHostMessage,e)}sendReadOutLoudStatus(i,s){let n=i===e.ReadingState.Playing,o=i===e.ReadingState.Playing||i===e.ReadingState.Paused,r=JSON.stringify({previousButtonVisibility:{isVisible:o,isActive:!0,isEnabled:n},nextButtonVisibility:{isVisible:o,isActive:!0,isEnabled:n},togglePlaybackButtonVisibility:{isVisible:o,isActive:!n,isEnabled:!0},settingsButtonVisibility:{isVisible:o,isActive:!0,isEnabled:!0},settingsButtonWarningVisibility:{isVisible:o&&!s,isActive:!0,isEnabled:!0},closeButtonVisibility:{isVisible:o,isActive:!0,isEnabled:!0},textReadingState:e.ReadingState[i].toLowerCase()});this.postMessageToHost(t.ReadOutLoudStatusHostMessage,r,e.ReadingState[i])}sendSpeechSettings(e,i,s){let n=JSON.stringify({supportedVoices:s,currentVoiceURI:i,currentReadingRate:e});this.postMessageToHost(t.ReadOutLoudSpeechSettingsHostMessage,n)}sendSwitchScopeTo(){this.postMessageToHost(t.ReadOutLoudSwitchScopeTo)}sendSwitchScopeFrom(e,i,s){let n={readingState:e,speechPreferences:i,isTransferred:s};this.postMessageToHost(t.ReadOutLoudSwitchScopeFrom,JSON.stringify(n))}sendTelemetryErrorMeasureNoPII(e,i){let s=JSON.stringify({errorType:e,errorContent:i});this.postMessageToHost(t.ReadOutLoudJsErrorTelemetryHostMessage,s)}sendTelemetry(e,...i){i&&i.length>0?i.unshift(e):i=[e],this.postMessageToHost(t.TelemetryMessage,...i)}postMessageToHost(e,...t){t&&t.length>0?(t.unshift(e),this.Ue.postMessageToHost(t)):this.Ue.postMessageToHost([e])}onMessageFromHost(i){switch(i[0]){case t.ReadOutLoudGetScopeCommand:this.postMessageToHost(t.ReadOutLoudScopeHostMessage);break;case t.ReadOutLoudSwitchScopeCommand:let s=e.JsonUtilities.parseJsonOrNull(i[1],"ReadOutLoudSpeechPreferences-ScopeState",this.B);this.Be.trigger(s);break;case t.ReadOutLoudStartCommand:this.De.trigger(i[1]);break;case t.ReadOutLoudStopCommand:this.qe.trigger(void 0);break;case t.ReadOutLoudPauseCommand:this.He.trigger(void 0);break;case t.ReadOutLoudResumeCommand:this.je.trigger(void 0);break;case t.ReadOutLoudNextCommand:this.Je.trigger(void 0);break;case t.ReadOutLoudPreviousCommand:this.ze.trigger(void 0);break;case t.ReadOutLoudChangeVoiceCommand:this.Xe.trigger(i[1]);break;case t.ReadOutLoudChangeRateCommand:let n=Number(i[1]);this.We.trigger(n);break;default:throw Error("Unknown Command")}}}t.ReadOutLoudStartCommand="ReadOutLoud_Start",t.ReadOutLoudStopCommand="ReadOutLoud_Stop",t.ReadOutLoudPauseCommand="ReadOutLoud_Pause",t.ReadOutLoudResumeCommand="ReadOutLoud_Resume",t.ReadOutLoudNextCommand="ReadOutLoud_Next",t.ReadOutLoudPreviousCommand="ReadOutLoud_Previous",t.ReadOutLoudChangeVoiceCommand="ReadOutLoud_ChangeVoice",t.ReadOutLoudChangeRateCommand="ReadOutLoud_ChangeRate",t.ReadOutLoudSwitchScopeCommand="ReadOutLoud_SwitchScope",t.ReadOutLoudGetScopeCommand="ReadOutLoud_GetScope",t.ReadOutLoudJsErrorTelemetryHostMessage="ReadOutLoud_Telemetry_JsError",t.TelemetryMessage="Telemetry",t.ReadOutLoudSpeechSettingsHostMessage="ReadOutLoud_SpeechSettings",t.ReadOutLoudSpeechPreferencesHostMessage="ReadOutLoud_SpeechPreferences",t.ReadOutLoudStatusHostMessage="ReadOutLoud_Status",t.ReadOutLoudScopeHostMessage="ReadOutLoud_Scope",t.ReadOutLoudSwitchScopeTo="ReadOutLoud_SwitchScopeTo",t.ReadOutLoudSwitchScopeFrom="ReadOutLoud_SwitchScopeFrom",e.HostProxy=t}(LearningTools||(LearningTools={})),function(e){e.TelemetryClient=class{constructor(e){this.Ge=e}reportReadOutLoudInternalError(e){this.reportNoPII("readOutLoud",e)}reportJsonParsingError(e){this.reportNoPII("jsonParsing",e)}reportComprehensionToolsError(e){this.reportNoPII("comprehensionTools",e)}reportComprehensionToolsStatus(e,t){this.Ge&&this.Ge.sendTelemetry("comprehensionToolsStatus",e,t)}reportNoPII(e,t){this.Ge&&this.Ge.sendTelemetryErrorMeasureNoPII(e,t)}}}(LearningTools||(LearningTools={})),function(e){let t;!function(t){const i="msreadoutspan";t.surroundTextBySpans=function(t,s,n){let o=e.Highlighter.surroundTextByTag(i,s,i=>e.StringUtilties.NONEMPTY_STRING_REGEX.test(i.textContent)&&t.textNodes.findIndex(e=>e===i)>=0,(e,i)=>{let s=t.textNodes.findIndex(t=>t===e);s>=0&&t.textNodes.splice(s,1,...i)},n),r={spans:o.value(),readingUnit:t};return{value:()=>r,release:()=>{o.release(),r.readingUnit.textNodes=r.readingUnit.textNodes.filter(e=>e.ownerDocument.contains(e))}}}}(t=e.ReadOutLoudHighlighter||(e.ReadOutLoudHighlighter={}))}(LearningTools||(LearningTools={})),function(e){e.ReadOutLoudEventHandlers=class{constructor(t,i,s){this.S=[],this.Ke=!1,this.Ge=t,this.Ye=i,this.Ze=e.ReadingState.Stopped,this.Qe=s,s&&(this.$e=document.activeElement,this.et=!1,window.onfocus=(()=>{this.et||this.Ge.sendSwitchScopeTo()}),window.onblur=(()=>{this.et||(this.Ke?this.tt&&this.it&&this.Ge.sendSwitchScopeFrom(this.it.getReadingState(),this.tt.getSpeechPreferences()):this.Ge.sendSwitchScopeFrom(e.ReadingState.Stopped,null))}),window.onbeforeunload=(()=>{if(this.tt&&this.it){let t=this.it.getReadingState();t!==e.ReadingState.Playing&&t!==e.ReadingState.Paused||this.sendReadOutLoudStatus(e.ReadingState.Stopped,!0)}})),this.registerHostEventHandlers()}reset(){this.S.forEach(e=>{e.release()}),this.S=[],this.it=null,this.tt=null,this.Ke=!1}initialize(t,i){if(this.Ye.initializeReadOutLoud(t,i),this.it=this.Ye.getReadOutLoudViewModel(),this.tt=this.Ye.getReadOutLoudSettingsViewModel(),this.it&&this.tt){let t=()=>{let e=this.tt.getVoice(),t=this.tt.getDropDownOptionsForVoices();e&&t&&this.Ge.sendSpeechSettings(this.tt.getReadingRate(),e.name,t)},i=t=>{this.it.getReadingState()!==e.ReadingState.Uninitialized&&this.Ge.sendSpeechPreferences(t)};this.S.push(this.tt.rateChanged().subscribe(()=>{t()})),this.S.push(this.tt.voiceChanged().subscribe(()=>{t()})),this.S.push(this.tt.voicesChanged().subscribe(()=>{t()})),this.S.push(this.tt.speechPreferencesChanged().subscribe(e=>{i(e)})),this.S.push(this.tt.compatibleVoiceAvailableChanged().subscribe(()=>{this.sendReadOutLoudStatus(this.it.getReadingState(),this.tt.getCompatibleVoiceAvailable())})),this.S.push(this.it.readingStateChanged().subscribe(()=>{this.sendReadOutLoudStatus(this.it.getReadingState(),this.tt.getCompatibleVoiceAvailable())}))}this.Ke=!0}registerHostEventHandlers(){this.Ge.readOutLoudSwitchScopeRequested().subscribe(t=>{t.readingState===e.ReadingState.Playing?(this.initialize(JSON.stringify(t.speechPreferences),!1),this.handleStartReadOutLoud(t)):t.readingState===e.ReadingState.Paused&&(this.initialize(JSON.stringify(t.speechPreferences),!1),this.it.pauseReading())}),this.Ge.readOutLoudStartRequested().subscribe(e=>{this.Ke||this.initialize(e,!0),this.handleStartReadOutLoud(null)}),this.Ge.readOutLoudStopRequested().subscribe(()=>{this.Ke&&this.it.stopReading()}),this.Ge.readOutLoudPauseRequested().subscribe(()=>{this.Ke&&this.it.pauseReading()}),this.Ge.readOutLoudResumeRequested().subscribe(()=>{this.Ke&&this.it.startReading()}),this.Ge.readOutLoudNextRequested().subscribe(()=>{this.Ke&&this.it.moveToNextUnit()}),this.Ge.readOutLoudPreviousRequested().subscribe(()=>{this.Ke&&this.it.moveToPreviousUnit()}),this.Ge.readOutLoudChangeRateRequested().subscribe(e=>{this.Ke&&this.tt.setReadingRate(e)}),this.Ge.readOutLoudChangeVoiceRequested().subscribe(e=>{this.Ke&&this.tt.setCurrentVoiceFromURI(e)})}sendReadOutLoudStatus(t,i){t!==e.ReadingState.Uninitialized&&(this.Ge.sendReadOutLoudStatus(t,i),t!==this.Ze&&t===e.ReadingState.Stopped&&this.reset(),this.Ze=t)}handleStartReadOutLoud(t){if(this.Qe&&(!t||t.isTransferred)){let t=this.$e?this.$e:document.activeElement;if(t){let i,s=t.tagName.toLowerCase();if("iframe"===s?i=t.contentWindow:"frame"===s&&(i=t.contentWindow),i){this.et=!0,window.focus();let s=this.tt?this.tt.getSpeechPreferences():null;if(this.Ge.sendSwitchScopeFrom(e.ReadingState.Playing,s,!0),i.focus(),this.et=!1,document.activeElement===t)return}}}this.it.startReading()}}}(LearningTools||(LearningTools={})),function(e){e.TelemetryClient=class extends LearningTools.TelemetryClient{constructor(e){super(e),this.st=e}reportLineFocusState(e,t){this.st&&this.st.sendTelemetry("lineFocusState",e,t?"enabled":"disabled")}reportNumberOfPages(e,t,i){this.st&&this.st.sendTelemetry("readingViewPageCount",e.toString(),t.toString(),i.toString())}}}(ReadingMode||(ReadingMode={})),function(e){class t{constructor(e){this.onScroll=(e=>{this.nt?(this.nt.release(),this.nt=null):0===this.ot.length&&(this.ot.push(LearningTools.ScrollSource.Unknown),this.rt.trigger(LearningTools.ScrollSource.Unknown));let t=setTimeout(()=>{this.ot.forEach(e=>this.ht.trigger(e)),this.ot=[],this.nt=null},500);this.nt={release:()=>clearTimeout(t)}}),this.T=e,this.nt=null,this.ht=new LearningTools.EventSource,this.rt=new LearningTools.EventSource,this.at=new LearningTools.EventSource,this.lt=this.isContentDirectionRTL(e),this.ut=ReadingViewViewer.getContentIframe(),this.dt=this.ut.contentDocument,this.ot=[],this.T.getElementById("MainContainer").addEventListener("scroll",this.onScroll),this.dt.addEventListener("scroll",this.onScroll),ReadingViewViewer.onTextSpacingApplied().subscribe(()=>this.applyTextSpacing()),ReadingViewViewer.onTextSpacingRemoved().subscribe(()=>this.removeTextSpacing())}getCurrentDocument(){return this.T}getIframeDocument(){return this.dt}getStartingPosition(e){let t=e?this.getSelectionStartRangeOnCurrentPage():null;return t||(t=this.getPageStartRange()),t||((t=this.dt.createRange()).selectNode(this.dt.body),t.collapse(!0)),t}getSelection(){let e=this.dt.getSelection();return e&&!e.isCollapsed&&e.rangeCount>0?e:null}getSelectionStartRangeOnCurrentPage(){let e,t=this.dt.getSelection();if(!(t&&!t.isCollapsed&&t.rangeCount>0))return null;switch((e=t.getRangeAt(0).cloneRange()).collapse(!0),ReadingViewViewer.getCurrentLayout()){case 0:{let t=ReadingViewViewer.getCurrentPageNumber(),i=ReadingViewViewer.getCurrentPageRanges(t);if(i.length>0&&e.compareBoundaryPoints(Range.START_TO_START,i[0])>=0&&e.compareBoundaryPoints(Range.END_TO_END,i[i.length-1])<=0)return e;break}case 1:return e;default:return null}return null}getCollapsedRangeRect(e){let t=e.getBoundingClientRect();return t.top=t.bottom,"rtl"===ReadingViewViewer.getArticleDirection()?t.right=t.left:t.left=t.right,t}getPageStartRange(){switch(ReadingViewViewer.getCurrentLayout()){case 0:{let e=ReadingViewViewer.getCurrentPageNumber(),t=ReadingViewViewer.getCurrentPageRanges(e);for(let e=0;e<t.length;e++){let i=t[e];if(i.getClientRects().length>0)return i}break}case 1:{let e=0;if(ReadingViewViewer.getIsLineFocusActive()){e=ReadingViewViewer.getLineFocusViewRect().top+1}let t=ReadingViewViewer.getBrowserWidth()/2,i=e=>e.getBoundingClientRect(),s=LearningTools.DomUtilties.getTextNodeFromPoint(this.dt,t,e,i);if(s)return LearningTools.DomUtilties.getRangeAfterYPositionOrDefault(this.dt,s,e,i);break}default:return null}return null}getDocumentStartRange(){let e=this.dt.createRange();return e.selectNode(this.dt.getElementById("title")),e}repaginate(){ReadingViewViewer.rePaginate()}getContentLanguage(){var e=this.T.documentElement.lang;return e.length>0?e:window.navigator.language}onUserActionStarted(){return null}onUserActionEnded(){return null}onScrollStart(){return this.rt}onScrollEnd(){return this.ht}onPositionReset(){return this.at}isElementVisible(e,t){return ReadingViewViewer.isClientRectVisible(t)}scrollElementIntoView(e,t,i,s,n=!0,o,r){return ReadingViewViewer.scrollClientRectIntoView(t,()=>{void 0!==s&&(this.ot.push(s),this.rt.trigger(s))},n,o,r)}scrollRangeIntoView(e){ReadingViewViewer.scrollClientRectIntoView(this.getCollapsedRangeRect(e))}addDropCaps(){var e=this.dt.getElementById("dropCapsParagraph");e&&e.classList.contains(t.ReadoutActiveDropCapsClass)&&e.classList.remove(t.ReadoutActiveDropCapsClass)}removeDropCaps(){var e=this.dt.getElementById("dropCapsParagraph");e&&e.classList.add(t.ReadoutActiveDropCapsClass)}executeActionAndMaintainPosition(e){let t=this.getPageStartRange();e(),this.repaginate(),t&&this.scrollRangeIntoView(t),this.at.trigger(void 0)}applyTextSpacing(){this.executeActionAndMaintainPosition(()=>this.dt.body.classList.add("textSpacing"))}removeTextSpacing(){this.executeActionAndMaintainPosition(()=>this.dt.body.classList.remove("textSpacing"))}isContentDirectionRTL(e){var t,i="";return(t=e.querySelector("main"))&&(i=t.getAttribute("dir")),!(LearningTools.StringUtilties.isNullOrEmpty(i)&&(i=e.body.dir,LearningTools.StringUtilties.isNullOrEmpty(i)&&(i=e.documentElement.dir,LearningTools.StringUtilties.isNullOrEmpty(i))))&&"rtl"===i}}t.ReadoutActiveDropCapsClass="active",e.ReadingViewContentProvider=t}(ReadingMode||(ReadingMode={})),function(e){class t{constructor(e){this.ct=null,this.gt="",this.ft=!1,this.wt=null,this.Lt=null,this.vt=e}setWordDecorationPosition(e,t,i){this.ct!==e&&(this.ct=e,this.ft=!1),this.Tt=t+i.charIndex,this.pt=i.charLength,this.gt=i.utterance.text.substr(i.charIndex,this.pt)}activateDecoration(e){this.ft||(e&LearningTools.DecorationType.Line&&this.updateLineDecoration(),e&LearningTools.DecorationType.Word&&this.updateWordDecoration(),e&LearningTools.DecorationType.Background&&this.addBackgroundDecoration())}deactivateDecoration(e){e&LearningTools.DecorationType.Word&&(this.removeWordDecoration(),this.bt=null),e&LearningTools.DecorationType.Line&&this.removeLineDecoration(),e&LearningTools.DecorationType.Background&&this.removeBackgroundDecoration()}isWordDecorationValid(){var e=this.wt?this.wt.value().spans[0]:null;return!!e&&this.vt.isElementVisible(e,e.getBoundingClientRect())}addBackgroundDecoration(){this.vt.getCurrentDocument().body.classList.add(t.ReadoutActiveBackgroundClass),this.vt.getIframeDocument().body.classList.add(t.ReadoutActiveIFrameClass),this.vt.removeDropCaps(),this.vt.getIframeDocument().getSelection().removeAllRanges()}updateWordDecoration(){if(this.removeWordDecoration(),!this.ft){let i=LearningTools.ReadingRangeManipulations.createRange(this.ct,this.Tt,this.pt);if(this.wt=i?LearningTools.ReadOutLoudHighlighter.surroundTextBySpans(this.ct,i,[t.ReadoutActiveWordClass]):null,this.wt){var e=this.wt.value().spans[0];this.vt.isElementVisible(e,this.bt)||this.vt.scrollElementIntoView(e,this.bt,null,LearningTools.ScrollSource.ReadAloud)}}}updateLineDecoration(){let e=LearningTools.ReadingRangeManipulations.createRange(this.ct,this.Tt,this.pt);if(this.ft=!e||e.toString()!==this.gt,this.ft)this.removeLineDecoration();else if(!this.isWordInCurrentLineRange(e)){this.removeLineDecoration(),e=LearningTools.ReadingRangeManipulations.createRange(this.ct,this.Tt,this.pt);let i=this.getLineRange(e);this.Lt=LearningTools.ReadOutLoudHighlighter.surroundTextBySpans(this.ct,i,[t.ReadoutActiveLineClass])}}getLineRange(e){let t=LearningTools.ReadingRangeManipulations.expandToLineRange(e,e=>e.getClientRects()),i=t.getClientRects();return this.Rt=i.item(0).top,this.Vt=i.item(0).bottom,this._t=i.item(0).left,this.St=i.item(i.length-1).right,t}isWordInCurrentLineRange(e){return this.bt=e.getClientRects().item(0),this.Rt===this.bt.top&&this.Vt===this.bt.bottom&&!(this.St<this.bt.left||this._t>this.bt.right)}removeBackgroundDecoration(){this.vt.getIframeDocument().body.classList.contains(t.ReadoutActiveIFrameClass)&&this.vt.getIframeDocument().body.classList.remove(t.ReadoutActiveIFrameClass),this.vt.getCurrentDocument().body.classList.contains(t.ReadoutActiveBackgroundClass)&&this.vt.getCurrentDocument().body.classList.remove(t.ReadoutActiveBackgroundClass),this.vt.addDropCaps()}removeWordDecoration(){this.wt&&(this.wt.release(),this.wt=null)}removeLineDecoration(){this.Lt&&(this.Lt.release(),this.Lt=null,this.Rt=null,this.St=null,this._t=null,this.Vt=null)}}t.ReadoutActiveWordClass="msreadout-word-highlight",t.ReadoutActiveLineClass="msreadout-line-highlight",t.ReadoutActiveBackgroundClass="msreadout-active-background",t.ReadoutActiveIFrameClass="msreadout-active",e.ReadingViewReadingHighlighter=t}(ReadingMode||(ReadingMode={})),function(e){e.ReadingViewReadingNavigator=class extends LearningTools.ReadingNavigator{constructor(e){super(),this.vt=e,this.Ct=null,this.Mt=new LearningTools.ReadingUnitNavigator}initializeAsync(){this.vt.removeDropCaps();let e=this.vt.getStartingPosition(!0),t=e.startContainer;return t.nodeType===Node.TEXT_NODE?this.Mt.setStartingNode(t,e.startOffset):t.nodeType===Node.ELEMENT_NODE?t.hasChildNodes()?e.startOffset>=t.childNodes.length?this.Mt.setStartingNode(t.nextSibling):this.Mt.setStartingNode(t.childNodes.item(e.startOffset)):this.Mt.setStartingNode(t):t.nodeType===Node.DOCUMENT_NODE&&this.Mt.setStartingNode(t.body),Promise.resolve(!0)}reset(){this.Ct=null}moveToPreviousUnitAsync(){return this.Ct=this.Mt.moveByAUnit(LearningTools.UnitDirection.Previous),this.Ct?Promise.resolve(!0):Promise.resolve(!1)}moveToNextUnitAsync(){return this.Ct=this.Mt.moveByAUnit(LearningTools.UnitDirection.Next),this.Ct?Promise.resolve(!0):Promise.resolve(!1)}getCurrentUnit(){return this.Ct}setCurrentUnitTextOffset(e){this.Ct.textOffset=e}}}(ReadingMode||(ReadingMode={})),function(e){e.LineFocusViewer=class{constructor(e){this.Me=e,this.kt=new LearningTools.EventSource,this.S=[]}enterLineFocusMode(){ReadingViewViewer.enterLineFocusMode(),this.S.push(ReadingViewViewer.onFontSizeChanged().subscribe(()=>this.kt.trigger(void 0))),this.S.push(ReadingViewViewer.onResized().subscribe(()=>this.kt.trigger(void 0))),this.S.push(this.Me.onPositionReset().subscribe(()=>this.kt.trigger(void 0)))}exitLineFocusMode(){this.S.forEach(e=>e.release()),this.S=[],ReadingViewViewer.exitLineFocusMode()}bringRectIntoLineFocusView(e,t){return this.Me.scrollElementIntoView(null,e,null,LearningTools.ScrollSource.LineFocus,t,!0,!0)}setLineFocusViewHeight(e){ReadingViewViewer.setLineFocusViewHeight(e)}getLineFocusViewRect(){return ReadingViewViewer.getLineFocusViewRect()}getMaxLineFocusViewHeight(){return ReadingViewViewer.getMaxLineFocusViewHeight()}getLineFocusViewMargins(){return ReadingViewViewer.getLineFocusViewMargins()}getLineFocusViewMarginTop(){return ReadingViewViewer.getLineFocusViewMarginTop()}getLineFocusViewMarginBottom(){return ReadingViewViewer.getLineFocusViewMarginBottom()}getBaseLineHeight(){return ReadingViewViewer.getBaseLineHeight()}onLayoutChanged(){return this.kt}onWheel(){return ReadingViewViewer.onWheelInLineFocus()}onKeyDown(){return ReadingViewViewer.onKeyDownInLineFocus()}}}(ReadingMode||(ReadingMode={})),function(e){class t extends LearningTools.ReadOutLoudViewModel{constructor(e,i,s,n,o){super(e,i,s,o),this.Nt=new LearningTools.EventSource,this.yt=LearningTools.ReadingState.Uninitialized,this.vt=n;let r=n.getContentLanguage();this.A=LearningTools.StringUtilties.isNullOrEmpty(r)?t.DefaultLocale:r,this.xt=i}getReadingState(){return this.yt}readingStateChanged(){return this.Nt}setReadingState(e){this.yt!==e&&(this.yt=e,this.Nt.trigger(void 0))}getLanguage(){return this.A}addUserActionStartedListener(e){return this.vt.onScrollStart().subscribe(t=>{t!==LearningTools.ScrollSource.ReadAloud&&e.onUserActionStarted()})}addUserActionCompletedListener(e){return this.vt.onScrollEnd().subscribe(t=>{t!==LearningTools.ScrollSource.ReadAloud&&e.onUserActionCompleted()})}isReadingPositionValid(){return this.xt.isWordDecorationValid()&&!this.vt.getSelectionStartRangeOnCurrentPage()}}t.DefaultLocale="en-US",e.ReadingViewReadOutLoudViewModel=t}(ReadingMode||(ReadingMode={})),function(e){let t;!function(e){e[e.Sepia=0]="Sepia",e[e.Light=1]="Light",e[e.Gray=2]="Gray",e[e.Black=3]="Black",e[e.Green=4]="Green",e[e.Blue=5]="Blue",e[e.Yellow=6]="Yellow",e[e.Rose=7]="Rose",e[e.Apricot=8]="Apricot",e[e.Lightorange=9]="Lightorange",e[e.Lightyellow=10]="Lightyellow",e[e.Lime=11]="Lime",e[e.Lightgreen=12]="Lightgreen",e[e.Lightteal=13]="Lightteal",e[e.Turquoise=14]="Turquoise",e[e.Teal=15]="Teal",e[e.Skyblue=16]="Skyblue",e[e.Lightblue=17]="Lightblue",e[e.Lavender=18]="Lavender",e[e.Orchid=19]="Orchid",e[e.Pink=20]="Pink",e[e.Carnation=21]="Carnation"}(t=e.Theme||(e.Theme={}))}(ReadingViewViewer||(ReadingViewViewer={})),function(e){e.ComprehensionToolsPOSColors="ComprehensionTools_PartsOfSpeechColors",e.ComprehensionToolsLineMarkersEnabled="ComprehensionTools_LineMarkersEnabled";e.ReadingViewSettingsStoreProxy=class{constructor(e){this.fe=LearningTools.JsonUtilities.parseJsonOrNull(e,"RV settings"),this.Pt=new LearningTools.EventSource}onSettingChanged(){return this.Pt}getSetting(e){if(this.fe&&this.fe.hasOwnProperty(e))return this.fe[e]}setSetting(e,t){this.fe&&this.fe.hasOwnProperty(e)&&(this.fe[e]=t,this.Pt.trigger({name:e,value:t}))}onSettingsUpdateFromHost(e){this.fe=LearningTools.JsonUtilities.parseJsonOrNull(e,"RV settings")}}}(ReadingMode||(ReadingMode={})),function(e){class t{constructor(i,s,n,o){this.B=n,this.Me=i,this.Ot=o,this.At=null,this.Et=null,this.It=null,this.Ft=null,this.Ut=!1,this.Bt=!1,this.Dt=!1,this.qt=!1,this.Ht=!1,this.jt=LearningTools.ComprehensionToolsState.idle,this.Jt=LearningTools.ComprehensionToolsState.idle,this.zt=LearningTools.ComprehensionToolsState.idle,this.Wt=LearningTools.ComprehensionToolsState.idle,this.Xt=new LearningTools.EventSource,this.Gt=new LearningTools.EventSource,this.Kt=new LearningTools.EventSource,this.Yt=new LearningTools.EventSource,this.Zt=new LearningTools.EventSource,this.Qt=new LearningTools.EventSource,this.$t=new LearningTools.EventSource,this.ei=new LearningTools.NLXAppProxy(s.sendNLXRequest.bind(s),s.onNLXResponseReceived());let r=i.getIframeDocument();this.ti=new LearningTools.DocumentComprehensionTools(r,r.location.href,0,i.getContentLanguage(),r.body,this.ei,ReadingViewViewer.localizedStrings,n,t.PosColorDataThemeMap);let h=LearningTools.JsonUtilities.parseJsonOrNull(o.getSetting(e.ComprehensionToolsPOSColors),"POSColors",n);this.ii=h?{nounsColorIndex:h.nounsColorIndex,verbsColorIndex:h.verbsColorIndex,adjectivesColorIndex:h.adjectivesColorIndex}:{nounsColorIndex:5,verbsColorIndex:4,adjectivesColorIndex:1},this.si=o.getSetting(e.ComprehensionToolsLineMarkersEnabled)}addSyllables(e){this.ni=e,this.Xt.trigger({isActive:!0,errors:[]}),this.activateComprehensionTool(e,LearningTools.ComprehensionToolType.syllables)}removeSyllables(){this.Xt.trigger({isActive:!1,errors:[]}),this.deactivateComprehensionTool(LearningTools.ComprehensionToolType.syllables)}addVerbHighlight(e){this.oi=e,this.Gt.trigger({isActive:!0,errors:[]}),this.activateComprehensionTool(e,LearningTools.ComprehensionToolType.verbs)}removeVerbHighlight(){this.Gt.trigger({isActive:!1,errors:[]}),this.deactivateComprehensionTool(LearningTools.ComprehensionToolType.verbs)}addNounHighlight(e){this.ri=e,this.Kt.trigger({isActive:!0,errors:[]}),this.activateComprehensionTool(e,LearningTools.ComprehensionToolType.nouns)}removeNounHighlight(){this.Kt.trigger({isActive:!1,errors:[]}),this.deactivateComprehensionTool(LearningTools.ComprehensionToolType.nouns)}addAdjectiveHighlight(e){this.hi=e,this.Yt.trigger({isActive:!0,errors:[]}),this.activateComprehensionTool(e,LearningTools.ComprehensionToolType.adjectives)}removeAdjectiveHighlight(){this.Yt.trigger({isActive:!1,errors:[]}),this.deactivateComprehensionTool(LearningTools.ComprehensionToolType.adjectives)}setAdjectivesColor(e){this.ii.adjectivesColorIndex=e,this.setPOSColor(LearningTools.ComprehensionToolType.adjectives)}setVerbsColor(e){this.ii.verbsColorIndex=e,this.setPOSColor(LearningTools.ComprehensionToolType.verbs)}setNounsColor(e){this.ii.nounsColorIndex=e,this.setPOSColor(LearningTools.ComprehensionToolType.nouns)}getLineMarkersState(){return this.si}addLineMarkers(){this.si=!0,this.ti.getProcessingState(LearningTools.ComprehensionToolType.pos)===LearningTools.ProcessingState.processed&&(this.ti.addLineMarkers(),this.Me.executeActionAndMaintainPosition(()=>{this.ti.setLineMarkersVisibility(this.si),ReadingViewViewer.setLineMarkersActive(this.si)})),this.Ot.setSetting(e.ComprehensionToolsLineMarkersEnabled,this.si),this.$t.trigger(this.si)}removeLineMarkers(){this.si=!1,this.Me.executeActionAndMaintainPosition(()=>{this.ti.setLineMarkersVisibility(this.si),ReadingViewViewer.setLineMarkersActive(this.si)}),this.Ot.setSetting(e.ComprehensionToolsLineMarkersEnabled,this.si),this.$t.trigger(this.si)}getPOSColorIndexes(){return this.ii}onSyllablesStatusChanged(){return this.Xt}onVerbsStatusChanged(){return this.Gt}onNounsStatusChanged(){return this.Kt}onAdjectivesStatusChanged(){return this.Yt}onProgressIndicatorVisibilityChanged(){return this.Zt}onPOSColorChanged(){return this.Qt}onLineMarkersStateChanged(){return this.$t}setPOSColor(i){if(t.PosColorDataThemeMap.size>0){let e=t.PosColorDataThemeMap.values().next().value.colors.length;LearningTools.DocumentComprehensionTools.AdjustColorIndexes(i,this.ii,e),this.ti.setColor(i,this.ii)}this.Qt.trigger(this.ii),this.Ot.setSetting(e.ComprehensionToolsPOSColors,JSON.stringify(this.ii))}activateComprehensionTool(e,t){this.setComprehensionToolsState(e,t,LearningTools.ComprehensionToolsState.activationRequested),this.setComprehensionToolActive(t,!0),this.processDocumentComprehension(this.Me.getIframeDocument(),t)}setComprehensionToolActive(e,t){switch(e){case LearningTools.ComprehensionToolType.syllables:this.Ut=t;break;case LearningTools.ComprehensionToolType.verbs:this.Bt=t;break;case LearningTools.ComprehensionToolType.nouns:this.Dt=t;break;case LearningTools.ComprehensionToolType.adjectives:this.qt=t}}getComprehensionToolActive(e){switch(e){case LearningTools.ComprehensionToolType.syllables:return this.Ut;case LearningTools.ComprehensionToolType.verbs:return this.Bt;case LearningTools.ComprehensionToolType.nouns:return this.Dt;case LearningTools.ComprehensionToolType.adjectives:return this.qt;default:return!1}}processDocumentComprehension(e,t){let i,s,n,o;switch(t){case LearningTools.ComprehensionToolType.syllables:o=this.ni,n=this.Xt,i=(e=>{this.At=e}),s=(()=>this.At);break;case LearningTools.ComprehensionToolType.verbs:o=this.oi,n=this.Gt,i=(e=>{this.Et=e}),s=(()=>this.Et);break;case LearningTools.ComprehensionToolType.nouns:o=this.ri,n=this.Kt,i=(e=>{this.It=e}),s=(()=>this.It);break;case LearningTools.ComprehensionToolType.adjectives:o=this.hi,n=this.Yt,i=(e=>{this.Ft=e}),s=(()=>this.Ft);break;default:return}let r=new LearningTools.CancellationToken;i(r),this.setProgressIndicatorVisibility(this.isRequestPending()),this.ti.markAsync(t,r).then(()=>{if(s()===r){if(i(null),this.getComprehensionToolActive(t)){let e=this.ti.getProcessingState(t)===LearningTools.ProcessingState.processed;e&&(t&LearningTools.ComprehensionToolType.pos&&(this.ti.setColor(t,this.ii),this.si&&this.ti.addLineMarkers()),this.ti.setVisibility(!1,t),this.Me.executeActionAndMaintainPosition(()=>{t&LearningTools.ComprehensionToolType.pos&&(this.ti.setLineMarkersVisibility(this.si),ReadingViewViewer.setLineMarkersActive(this.si)),this.ti.setVisibility(!0,t)}));let i=[];this.ti.getLanguageErrors(t).forEach((e,t)=>{i.push({errorCode:t,errorParameters:[...e]})});let s=this.ti.getFatalErrors(t);s&&i.push(s),n.trigger({isActive:this.getComprehensionToolActive(t),errors:i}),i.length>0&&this.B.reportComprehensionToolsError(JSON.stringify({comprehensionId:o,errorType:"NLXResponseError",errorData:i})),this.getComprehensionToolsSate(t)===LearningTools.ComprehensionToolsState.activationRequested&&this.setComprehensionToolsState(o,t,e?LearningTools.ComprehensionToolsState.firstResponseCompleted:LearningTools.ComprehensionToolsState.firstResponseFailed)}this.setProgressIndicatorVisibility(this.isRequestPending())}},()=>{s()===r&&i(null),this.setProgressIndicatorVisibility(this.isRequestPending())})}deactivateComprehensionTool(e){let t;switch(this.setComprehensionToolActive(e,!1),e){case LearningTools.ComprehensionToolType.syllables:this.setComprehensionToolsState(this.ni,e,LearningTools.ComprehensionToolsState.deactivationRequested),this.At&&(this.At.cancel(),this.At=null),t=this.Xt;break;case LearningTools.ComprehensionToolType.verbs:this.setComprehensionToolsState(this.oi,e,LearningTools.ComprehensionToolsState.deactivationRequested),this.Et&&(this.Et.cancel(),this.Et=null),t=this.Gt;break;case LearningTools.ComprehensionToolType.nouns:this.setComprehensionToolsState(this.ri,e,LearningTools.ComprehensionToolsState.deactivationRequested),this.It&&(this.It.cancel(),this.It=null),t=this.Kt;break;case LearningTools.ComprehensionToolType.adjectives:this.setComprehensionToolsState(this.hi,e,LearningTools.ComprehensionToolsState.deactivationRequested),this.Ft&&(this.Ft.cancel(),this.Ft=null),t=this.Yt;break;default:return}this.Me.executeActionAndMaintainPosition(()=>this.ti.setVisibility(!1,e)),t.trigger({isActive:this.getComprehensionToolActive(e),errors:null})}getComprehensionToolsSate(e){switch(e){case LearningTools.ComprehensionToolType.syllables:return this.jt;case LearningTools.ComprehensionToolType.nouns:return this.Jt;case LearningTools.ComprehensionToolType.verbs:return this.zt;case LearningTools.ComprehensionToolType.adjectives:return this.Wt;default:return LearningTools.ComprehensionToolsState.idle}}setComprehensionToolsState(e,t,i){switch(t){case LearningTools.ComprehensionToolType.syllables:this.jt=i;break;case LearningTools.ComprehensionToolType.nouns:this.Jt=i;break;case LearningTools.ComprehensionToolType.verbs:this.zt=i;break;case LearningTools.ComprehensionToolType.adjectives:this.Wt=i;break;default:return}this.B.reportComprehensionToolsStatus(e,LearningTools.ComprehensionToolsState[i])}setProgressIndicatorVisibility(e){e!==this.Ht&&(this.Ht=e,this.Zt.trigger(this.Ht))}isRequestPending(){return!!(this.At||this.It||this.Et||this.Ft)}}t.PosColorDataThemeMap=new Map([[ReadingViewViewer.Theme.Light,{propertyName:"--background-light-comprehensiontools",colors:["#0c4d8a","#00661d","#815c12","#a34f00","#a80005","#9332a1","#0063c3","#008923","#c49800","#e06a00","#d82904","#b639d8"]}],[ReadingViewViewer.Theme.Black,{propertyName:"--background-dark-comprehensiontools",colors:["#4da4fc","#6ec136","#e4c400","#f58f00","#ff5e5e","#c577e4","#0063c3","#008923","#c49800","#e06a00","#d82904","#b639d8"]}]]),e.ReadingViewComprehensionTools=t}(ReadingMode||(ReadingMode={})),function(e){e.LearningToolsPanelViewModel=class{constructor(e,t,i){this.ti=e,this.ai=t,this.li=new LearningTools.EventSource,this.ui={isActive:!1,errors:null},this.di={isActive:!1,errors:null},this.ci={isActive:!1,errors:null},this.gi={isActive:!1,errors:null},this.Ht=!1,this.Ne=!1,this.mi=this.ai.getCurrentLineCount(),this.xe=this.ai.getMaxLineCount(),this.ii=this.ti.getPOSColorIndexes(),this.si=this.ti.getLineMarkersState(),this.Zt=new LearningTools.EventSource,e&&(e.onSyllablesStatusChanged().subscribe(e=>{this.ui=e,this.li.trigger(void 0)}),e.onNounsStatusChanged().subscribe(e=>{this.di=e,this.li.trigger(void 0)}),e.onVerbsStatusChanged().subscribe(e=>{this.ci=e,this.li.trigger(void 0)}),e.onAdjectivesStatusChanged().subscribe(e=>{this.gi=e,this.li.trigger(void 0)}),e.onProgressIndicatorVisibilityChanged().subscribe(e=>{this.Ht=e,this.Zt.trigger(e),this.li.trigger(void 0)}),e.onPOSColorChanged().subscribe(e=>{this.ii=e,this.li.trigger(void 0)}),e.onLineMarkersStateChanged().subscribe(e=>{this.si=e,this.li.trigger(void 0)}),t.onLineFocusStateChanged().subscribe(e=>{this.Ne=e,this.li.trigger(void 0)}),t.onLineCountChanged().subscribe(e=>{this.mi=e,this.li.trigger(void 0)}),t.onMaxLineCountChanged().subscribe(e=>{this.xe=e,this.li.trigger(void 0)}))}addSyllables(e){this.ti.addSyllables(e)}removeSyllables(){this.ti.removeSyllables()}addVerbHighlight(e){this.ti.addVerbHighlight(e)}removeVerbHighlight(){this.ti.removeVerbHighlight()}addNounHighlight(e){this.ti.addNounHighlight(e)}removeNounHighlight(){this.ti.removeNounHighlight()}addAdjectiveHighlight(e){this.ti.addAdjectiveHighlight(e)}removeAdjectiveHighlight(){this.ti.removeAdjectiveHighlight()}enableLineFocus(e){this.ai.enterLineFocusMode(e)}setNounsColor(e){this.ti.setNounsColor(e)}setVerbsColor(e){this.ti.setVerbsColor(e)}setAdjectivesColor(e){this.ti.setAdjectivesColor(e)}addLineMarkers(){this.ti.addLineMarkers()}removeLineMarkers(){this.ti.removeLineMarkers()}disableLineFocus(){this.ai.exitLineFocusMode()}setNumberOfLinesInFocus(e){this.ai.setLineCount(e)}moveToNextInLineFocus(){this.ai.moveToNext()}moveToPreviousInLineFocus(){this.ai.moveToPrevious()}onLearningToolsStatusChanged(){return this.li}onProgressIndicatorVisibilityChanged(){return this.Zt}learningToolsPanelStatus(){return{syllablesStatus:this.ui,nounsStatus:this.di,verbsStatus:this.ci,adjectivesStatus:this.gi,nounsColorIndex:this.ii.nounsColorIndex,verbsColorIndex:this.ii.verbsColorIndex,adjectivesColorIndex:this.ii.adjectivesColorIndex,isLineMarkersActive:this.si,isProgressIndicatorVisible:this.Ht,isLineFocusActive:this.Ne,lineCount:this.mi,maxLineCount:this.xe}}}}(ReadingMode||(ReadingMode={})),function(e){e.MainViewModel=class{constructor(t,i,s,n){this.vt=s,this.it=null,this.tt=null,this.fi=i,this.Ot=n,this.B=new e.TelemetryClient(t)}initializeReadOutLoud(t,i){var s=new e.ReadingViewReadingNavigator(this.vt),n=new e.ReadingViewReadingHighlighter(this.vt);this.tt=new LearningTools.ReadOutLoudSettingsViewModel(t,this.B),this.it=new e.ReadingViewReadOutLoudViewModel(s,n,this.tt,this.vt,this.B)}initializeLearningToolsPanel(){let t=new e.ReadingViewComprehensionTools(this.vt,this.fi,this.B,this.Ot),i=new e.LineFocusViewer(this.vt),s=new LearningTools.LineFocusUnitProvider,n=new LearningTools.LineFocus(i,this.vt,s,this.Ot,this.B);this.wi=new e.LearningToolsPanelViewModel(t,n,this.B)}getReadOutLoudViewModel(){return this.it}getReadOutLoudSettingsViewModel(){return this.tt}getLearningToolsPanelViewModel(){return this.wi}}}(ReadingMode||(ReadingMode={})),function(e){class t extends LearningTools.EventSource{addListener(e){this.subscribe(e)}}e.LearningToolsRuntime=class{constructor(e){this.Li=new t,this.onMessageFromHost=this.Li,this.vi=e}postMessageToHost(e){var t={message:"LearningToolsMessage",dataJson:e};this.vi.postMessageToHost(t)}raiseMessageFromHostEvent(e){this.Li.trigger(e)}}}(ReadingViewViewer||(ReadingViewViewer={})),function(e){let t;!function(e){e[e.learningToolsCommand=0]="learningToolsCommand",e[e.readingViewCommand=1]="readingViewCommand"}(t=e.HostCommandName||(e.HostCommandName={}))}(ReadingViewViewer||(ReadingViewViewer={})),function(e){let t;!function(e){e[e.ExtraExtraSmall=0]="ExtraExtraSmall",e[e.ExtraSmall=1]="ExtraSmall",e[e.Small=2]="Small",e[e.Medium=3]="Medium",e[e.Large=4]="Large",e[e.ExtraLarge=5]="ExtraLarge",e[e.ExtraExtraLarge=6]="ExtraExtraLarge"}(t=e.FontSize||(e.FontSize={}))}(ReadingViewViewer||(ReadingViewViewer={})),function(e){e.ReadingViewRuntime=class{constructor(e){this.Ti=e}unload(){this.Ti.close()}setLearningToolsRuntime(e){this.pi=e}postMessageToHost(e){var t=JSON.stringify(e);this.Ti.postToHost(t)}messageFromHost(t){var i=LearningTools.JsonUtilities.parseJsonOrNull(t,"RawCommandObject",null);switch(e.HostCommandName[String(i.command)]){case e.HostCommandName.learningToolsCommand:this.pi.raiseMessageFromHostEvent(i.dataJson);break;case e.HostCommandName.readingViewCommand:if(i.dataJson.length>0)switch(i.dataJson[0]){case"applyTextSpacing":e.applyTextSpacing();break;case"removeTextSpacing":e.removeTextSpacing();break;case"applyTheme":if(2!==i.dataJson.length)throw new Error("Unknown number of params in applying theme");e.applyTheme(parseInt(i.dataJson[1]));break;case"setFontSize":if(2!==i.dataJson.length)throw new Error("Unknown number of params in applying font");e.setFontSize(parseInt(i.dataJson[1]));break;case"showProgressIndicator":e.setProgressIndicatorVisible(!0);break;case"hideProgressIndicator":e.setProgressIndicatorVisible(!1);break;default:throw new Error("Unknown Command From Host")}break;default:throw new Error("Unknown Command From Host")}}}}(ReadingViewViewer||(ReadingViewViewer={})),function(e){class t extends LearningTools.HostProxy{constructor(e){super(e),this.bi=new LearningTools.EventSource,this.Ri=new LearningTools.EventSource,this.Vi=new LearningTools.EventSource,this._i=new LearningTools.EventSource,this.Si=new LearningTools.EventSource,this.Ci=new LearningTools.EventSource,this.Mi=new LearningTools.EventSource,this.ki=new LearningTools.EventSource,this.Ni=new LearningTools.EventSource,this.yi=new LearningTools.EventSource,this.xi=new LearningTools.EventSource,this.Pi=new LearningTools.EventSource,this.Oi=new LearningTools.EventSource,this.Ai=new LearningTools.EventSource,this.Ei=new LearningTools.EventSource,this.Ii=new LearningTools.EventSource,this.Fi=new LearningTools.EventSource,this.Ui=new LearningTools.EventSource}settingsUpdateRequested(){return this.bi}addSyllablesRequested(){return this.Ri}addNounsRequested(){return this.Vi}addVerbsRequested(){return this._i}addAdjectivesRequested(){return this.Si}removeSyllablesRequested(){return this.Ci}removeNounsRequested(){return this.Mi}removeVerbsRequested(){return this.ki}removeAdjectivesRequested(){return this.Ni}setNounsColorRequested(){return this.yi}setVerbsColorRequested(){return this.xi}setAdjectivesColorRequested(){return this.Pi}onNLXResponseReceived(){return this.Oi}addLineMarkers(){return this.Ai}removeLineMarkers(){return this.Ei}sendNLXRequest(e){this.postMessageToHost(t.ProcessNLXRequest,e.contextId,e.requestType,e.metaJson?e.metaJson:"",e.action?e.action:"",e.version?e.version:"",e.optionsJson?e.optionsJson:"",e.dataJson?e.dataJson:"")}sendTelemetryErrorMeasureNoPII(e,i){let s=JSON.stringify({errorType:e,errorContent:i});"comprehensionTools"===e?this.postMessageToHost(t.ComprehensionToolsJsErrorTelemetryHostMessage,s):super.sendTelemetryErrorMeasureNoPII(e,i)}enableLineFocusRequested(){return this.Ii}disableLineFocusRequested(){return this.Fi}setNumberOfLinesInFocusRequested(){return this.Ui}sendReadingViewSelectionUi(e,i,s,n){let o=JSON.stringify({positionX:s,positionY:n,uiPositionPreference:"AboveTextSelection",source:"ReadingMode",selectionTextData:{selectionText:e,selectionTextContext:i}});this.postMessageToHost(t.ReadingModeShowSelectionUI,o)}sendReadingViewDismissSelectionUi(){this.postMessageToHost(t.ReadingModeCloseSelectionUI)}sendLearningToolsPanelStatus(e){let i=JSON.stringify({syllablesButtonVisibility:{isVisible:!0,isActive:e.syllablesStatus.isActive,isEnabled:!0},syllablesErrors:e.syllablesStatus.errors,nounsButtonVisibility:{isVisible:!0,isActive:e.nounsStatus.isActive,isEnabled:!0},nounsErrors:e.nounsStatus.errors,verbsButtonVisibility:{isVisible:!0,isActive:e.verbsStatus.isActive,isEnabled:!0},verbsErrors:e.verbsStatus.errors,adjectivesButtonVisibility:{isVisible:!0,isActive:e.adjectivesStatus.isActive,isEnabled:!0},adjectivesErrors:e.adjectivesStatus.errors,nounsColorIndex:e.nounsColorIndex,verbsColorIndex:e.verbsColorIndex,adjectivesColorIndex:e.adjectivesColorIndex,isLineMarkersActive:e.isLineMarkersActive,isProgressIndicatorVisible:e.isProgressIndicatorVisible,lineFocusButtonVisibility:{isVisible:!0,isActive:e.isLineFocusActive,isEnabled:!0},lineCount:e.lineCount,maxLineCount:e.maxLineCount});this.postMessageToHost(t.LearningToolsPanelStatusHostMessage,i)}sendReadingViewSettings(e,i){this.postMessageToHost(t.ReadingViewSettingsHostMessage,e,i.toString())}onMessageFromHost(e){switch(e[0]){case t.ReadingViewSettingsUpdateCommand:this.bi.trigger(e[1]);break;case t.ComprehensionToolsAddSyllablesCommand:e[2]===t.ShowProgressIndicatorCommand&&ReadingViewViewer.setProgressIndicatorVisible(!0),this.Ri.trigger(e[1]);break;case t.ComprehensionToolsAddNounsCommand:e[2]===t.ShowProgressIndicatorCommand&&ReadingViewViewer.setProgressIndicatorVisible(!0),this.Vi.trigger(e[1]);break;case t.ComprehensionToolsAddVerbsCommand:e[2]===t.ShowProgressIndicatorCommand&&ReadingViewViewer.setProgressIndicatorVisible(!0),this._i.trigger(e[1]);break;case t.ComprehensionToolsAddAdjectivesCommand:e[2]===t.ShowProgressIndicatorCommand&&ReadingViewViewer.setProgressIndicatorVisible(!0),this.Si.trigger(e[1]);break;case t.ComprehensionToolsRemoveSyllablesCommand:this.Ci.trigger(void 0);break;case t.ComprehensionToolsRemoveNounsCommand:this.Mi.trigger(void 0);break;case t.ComprehensionToolsRemoveVerbsCommand:this.ki.trigger(void 0);break;case t.ComprehensionToolsRemoveAdjectivesCommand:this.Ni.trigger(void 0);break;case t.ComprehensionToolsSetNounsColorCommand:this.yi.trigger(Number(e[1]));break;case t.ComprehensionToolsSetVerbsColorCommand:this.xi.trigger(Number(e[1]));break;case t.ComprehensionToolsSetAdjectivesColorCommand:this.Pi.trigger(Number(e[1]));break;case t.ComprehensionToolsAddLineMarkersCommand:this.Ai.trigger(void 0);break;case t.ComprehensionToolsRemoveLineMarkersCommand:this.Ei.trigger(void 0);break;case t.ProcessNLXResponse:let i={contextId:e[2],responseType:e[3],metaJson:e[4],version:e[5],status:e[6],dataJson:e[7],errorJson:e[8]};this.Oi.trigger(i);break;case t.LineFocusEnableCommand:this.Ii.trigger(e[1]);break;case t.LineFocusDisableCommand:this.Fi.trigger(void 0);break;case t.LineFocusSetNumberOfLinesCommand:let s=Number(e[1]);this.Ui.trigger(s);break;default:super.onMessageFromHost(e)}}}t.ShowProgressIndicatorCommand="ShowProgressIndicator",t.LineFocusEnableCommand="LineFocus_Enable",t.LineFocusDisableCommand="LineFocus_Disable",t.LineFocusSetNumberOfLinesCommand="LineFocus_SetNumberOfLines",t.ComprehensionToolsAddSyllablesCommand="ComprehensionTools_AddSyllables",t.ComprehensionToolsAddNounsCommand="ComprehensionTools_AddNouns",t.ComprehensionToolsAddVerbsCommand="ComprehensionTools_AddVerbs",t.ComprehensionToolsAddAdjectivesCommand="ComprehensionTools_AddAdjectives",t.ComprehensionToolsRemoveSyllablesCommand="ComprehensionTools_RemoveSyllables",t.ComprehensionToolsRemoveNounsCommand="ComprehensionTools_RemoveNouns",t.ComprehensionToolsRemoveVerbsCommand="ComprehensionTools_RemoveVerbs",t.ComprehensionToolsRemoveAdjectivesCommand="ComprehensionTools_RemoveAdjectives",t.ComprehensionToolsSetNounsColorCommand="ComprehensionTools_SetNounsColor",t.ComprehensionToolsSetVerbsColorCommand="ComprehensionTools_SetVerbsColor",t.ComprehensionToolsSetAdjectivesColorCommand="ComprehensionTools_SetAdjectivesColor",t.ComprehensionToolsAddLineMarkersCommand="ComprehensionTools_AddLineMarkers",t.ComprehensionToolsRemoveLineMarkersCommand="ComprehensionTools_RemoveLineMarkers",t.ProcessNLXResponse="NLXResponse",t.ReadingViewSettingsUpdateCommand="c_readingViewSettingsUpdateFromHost",t.ReadingViewSettingsHostMessage="ReadingView_Settings",t.ComprehensionToolsJsErrorTelemetryHostMessage="ComprehensionTools_Telemetry_JsError",t.ProcessNLXRequest="NLXRequest",t.LearningToolsPanelStatusHostMessage="LearningToolsPanel_Status",t.ReadingModeShowSelectionUI="ReadingMode_ShowSelectionUI",t.ReadingModeCloseSelectionUI="ReadingMode_CloseSelectionUI",e.ReadingModeHostProxy=t}(ReadingMode||(ReadingMode={})),function(e){e.LearningToolsEventHandlers=class{constructor(e,t){this.S=[],this.Ke=!1,this.Ge=e,this.Ye=t,this.registerHostEventHandlers(),this.registerViewEventHandlers()}reset(){this.S.forEach(e=>{e.release()}),this.S=[],this.wi=null,this.Ke=!1}ensureInitialize(){if(!this.Ke){if(this.Ye.initializeLearningToolsPanel(),this.wi=this.Ye.getLearningToolsPanelViewModel(),this.wi){let e=()=>{this.Ge.sendLearningToolsPanelStatus(this.wi.learningToolsPanelStatus())};this.S.push(this.wi.onLearningToolsStatusChanged().subscribe(()=>{e()})),this.S.push(this.wi.onProgressIndicatorVisibilityChanged().subscribe(e=>{e||ReadingViewViewer.setProgressIndicatorVisible(e)})),e()}this.Ke=!0}}registerHostEventHandlers(){this.Ge.addSyllablesRequested().subscribe(e=>{this.ensureInitialize(),this.wi.addSyllables(e)}),this.Ge.addNounsRequested().subscribe(e=>{this.ensureInitialize(),this.wi.addNounHighlight(e)}),this.Ge.addVerbsRequested().subscribe(e=>{this.ensureInitialize(),this.wi.addVerbHighlight(e)}),this.Ge.addAdjectivesRequested().subscribe(e=>{this.ensureInitialize(),this.wi.addAdjectiveHighlight(e)}),this.Ge.removeSyllablesRequested().subscribe(()=>{this.ensureInitialize(),this.wi.removeSyllables()}),this.Ge.removeNounsRequested().subscribe(()=>{this.ensureInitialize(),this.wi.removeNounHighlight()}),this.Ge.removeVerbsRequested().subscribe(()=>{this.ensureInitialize(),this.wi.removeVerbHighlight()}),this.Ge.removeAdjectivesRequested().subscribe(()=>{this.ensureInitialize(),this.wi.removeAdjectiveHighlight()}),this.Ge.enableLineFocusRequested().subscribe(e=>{this.ensureInitialize(),this.wi.enableLineFocus(e)}),this.Ge.disableLineFocusRequested().subscribe(()=>{this.ensureInitialize(),this.wi.disableLineFocus()}),this.Ge.setNumberOfLinesInFocusRequested().subscribe(e=>{this.ensureInitialize(),this.wi.setNumberOfLinesInFocus(e)}),this.Ge.setNounsColorRequested().subscribe(e=>{this.ensureInitialize(),this.wi.setNounsColor(e)}),this.Ge.setVerbsColorRequested().subscribe(e=>{this.ensureInitialize(),this.wi.setVerbsColor(e)}),this.Ge.setAdjectivesColorRequested().subscribe(e=>{this.ensureInitialize(),this.wi.setAdjectivesColor(e)}),this.Ge.addLineMarkers().subscribe(()=>{this.ensureInitialize(),this.wi.addLineMarkers()}),this.Ge.removeLineMarkers().subscribe(()=>{this.ensureInitialize(),this.wi.removeLineMarkers()})}registerViewEventHandlers(){let e=document.getElementById("lineFocusDownButton");this.S.push(LearningTools.DomUtilties.addReleasableDomEventListener(e,"click",()=>{this.ensureInitialize(),this.wi.moveToNextInLineFocus()})),e=document.getElementById("lineFocusUpButton"),this.S.push(LearningTools.DomUtilties.addReleasableDomEventListener(e,"click",()=>{this.ensureInitialize(),this.wi.moveToPreviousInLineFocus()}))}}}(ReadingMode||(ReadingMode={})),function(e){"use strict";const t=-1,i=0,s=1;let n,o=0,r="ltr",h=33,a=16,l=80,u=80,d=!0,c=2*h*a,g=!1,m=-1,f=!1,w=!1,L=document.documentElement.clientHeight,v=document.documentElement.clientWidth,T=new LearningTools.EventSource,p=new LearningTools.EventSource,b=new LearningTools.EventSource,R=new LearningTools.EventSource,V=new LearningTools.EventSource,_=null,S=null,C=new LearningTools.EventSource,M=new LearningTools.EventSource,k=[];e.READINGBAR_HEIGHT=44,e.localizedStrings={},e.readingViewSettingsStoreProxy=null;const N=new Map([[e.Theme.Light,"ms-theme-light"],[e.Theme.Sepia,"ms-theme-sepia"],[e.Theme.Gray,"ms-theme-gray"],[e.Theme.Black,"ms-theme-dark"],[e.Theme.Green,"ms-theme-green"],[e.Theme.Blue,"ms-theme-blue"],[e.Theme.Yellow,"ms-theme-yellow"],[e.Theme.Rose,"ms-theme-rose"],[e.Theme.Apricot,"ms-theme-apricot"],[e.Theme.Lightorange,"ms-theme-lightorange"],[e.Theme.Lightyellow,"ms-theme-lightyellow"],[e.Theme.Lime,"ms-theme-lime"],[e.Theme.Lightgreen,"ms-theme-lightgreen"],[e.Theme.Lightteal,"ms-theme-lightteal"],[e.Theme.Turquoise,"ms-theme-turquoise"],[e.Theme.Teal,"ms-theme-teal"],[e.Theme.Skyblue,"ms-theme-skyblue"],[e.Theme.Lightblue,"ms-theme-lightblue"],[e.Theme.Lavender,"ms-theme-lavender"],[e.Theme.Orchid,"ms-theme-orchid"],[e.Theme.Pink,"ms-theme-pink"],[e.Theme.Carnation,"ms-theme-carnation"]]),y=new Map([[e.FontSize.ExtraExtraSmall,"82%"],[e.FontSize.ExtraSmall,"91%"],[e.FontSize.Small,"100%"],[e.FontSize.Medium,"114%"],[e.FontSize.Large,"136%"],[e.FontSize.ExtraLarge,"182%"],[e.FontSize.ExtraExtraLarge,"341%"]]);function x(e){e.ctrlKey&&(e.stopPropagation(),e.preventDefault())}function P(){if(!(n=document.getElementById("__rv_dataSource"))){var e=document.createElement("iframe");e.setAttribute("id","__rv_dataSource"),e.style.border="0px",document.getElementById("MainContainer").appendChild(e),n=e}window.addEventListener("wheel",x,!0),n.contentWindow.addEventListener("wheel",x,!0),window.onbeforeprint=(()=>{n.contentWindow.document.execCommand("print",!1,null)})}function O(e){let t=e.getElementsByTagName("table");for(let n=0;n<t.length;n++){let o=t[n];o.setAttribute("responsive","true");let r=o.querySelectorAll("tr");if(r.length>1){let e=r[0],t=e.childNodes.length;if(t>1){e.setAttribute("responsive","true");let n=[];for(let i=0;i<t;i++)if(e.childNodes[i].nodeType===Node.ELEMENT_NODE){let t=e.childNodes[i];n.push(t.innerText)}for(let e=1;e<r.length;e++){var i=0;for(let t=0;t<r[e].childNodes.length;t++){var s=r[e].childNodes[t];if(s.nodeType===Node.ELEMENT_NODE){s.setAttribute("data-th",n[i]),i++}}}}}let h=e.createElement("thead"),a=e.createElement("tr");h.appendChild(a);let l=e.createElement("th");a.appendChild(l),a.style.height="0",o.insertBefore(h,o.children[0])}}function A(){let e=document.createElement("div");return e.className="viewportContainer",e.style.width=document.documentElement.clientWidth+"px",e}function E(e){let t=document.createElement("div");return t.className="__rv_region",t.style.width=e+"px",t}function I(e){z();let t=function(e){let t=document.documentElement.clientWidth,i=E(e),s=A(),n=document.getElementById("regionContainer");s.style.left="0px",s.appendChild(i),n.appendChild(s);let o=document.getElementById("leftButton"),h=t-parseInt(window.getComputedStyle(o,null).getPropertyValue("width"))-2*parseInt(window.getComputedStyle(o,null).getPropertyValue("margin-right")),a=e+parseInt(window.getComputedStyle(i,null).getPropertyValue("margin-right")),l=Math.floor(h/a),u=1,d=1;for(;"overflow"===i.msRegionOverflow;){let t=E(e);u>Math.floor(d/l)?s.appendChild(t):(u++,(s=A()).style.left="rtl"===r?-1*(u-1)*document.documentElement.clientWidth+"px":(u-1)*document.documentElement.clientWidth+"px",s.appendChild(t),n.appendChild(s)),d++,i=t}for(;d%l!=0;){let t=E(e);s.appendChild(t),d++}return u}(e);!function(e){let t=document.getElementById("page_carousel");if(e>=2&&e<7){t.style.display="block";for(let i=0;i<e;i++){let e=document.createElement("span");e.className="carousel_dots",t.appendChild(e)}H()}else t.style.display="none"}(t),o=t,ce()}function F(){let e=document.getElementById("MainContainer").scrollLeft;if(d){d=!1;let t=e%document.documentElement.clientWidth;if(0!==t)return document.getElementById("MainContainer").scrollLeft+=document.documentElement.clientWidth-t,void(d=!0);let i=setInterval(()=>{document.getElementById("MainContainer").scrollLeft+=document.documentElement.clientWidth/20,document.getElementById("MainContainer").scrollLeft>=e+document.documentElement.clientWidth&&(document.getElementById("MainContainer").scrollLeft=e+document.documentElement.clientWidth,clearInterval(i),d=!0)},15)}}function U(){let e=document.getElementById("MainContainer").scrollLeft;if(d){d=!1;let t=e%document.documentElement.clientWidth;if(0!==t)return document.getElementById("MainContainer").scrollLeft-=t,void(d=!0);let i=setInterval(()=>{document.getElementById("MainContainer").scrollLeft-=document.documentElement.clientWidth/20,document.getElementById("MainContainer").scrollLeft<=e-document.documentElement.clientWidth&&(document.getElementById("MainContainer").scrollLeft=e-document.documentElement.clientWidth,clearInterval(i),d=!0)},15)}}function B(){"rtl"===r?U():F(),H()}function D(){"rtl"===r?F():U(),H()}function q(e){ue("dominantimage").getAttribute("src"),n.contentDocument.getElementsByClassName("__reading__mode__extracted__imagecontainer");let t=de("img");for(let i=0;i<t.length;i++){let s=3/8,n=t[i];n.style.cssFloat="none",n.classList.remove("ienolimitimage"),n.naturalHeight>document.documentElement.clientHeight*s?(n.classList.add("prvheightlimitimage"),n.width>=e&&n.classList.add("prvwidthlimitimage")):n.naturalWidth>=e?n.classList.add("prvwidthlimitimage"):n.classList.add("ienolimitimage")}let i=de("iframe");for(let e=0;e<i.length;e++){let t=i[e];t.style.maxWidth="100%",t.style.maxHeight="100%"}let s=de("video");for(let e=0;e<s.length;e++){let t=s[e];t.style.maxWidth="100%",t.style.maxHeight="100%"}}function H(){let e=document.getElementById("page_carousel");if(ce(),"none"!==e.style.display){let t=Math.round(document.getElementById("MainContainer").scrollLeft/document.documentElement.clientWidth),i=e.querySelector(".carousel_dots_checked");i&&i.classList.remove("carousel_dots_checked");let s=e.getElementsByClassName("carousel_dots");s.length>0&&t<s.length&&s[t].classList.add("carousel_dots_checked")}}function j(){n.setAttribute("msallowfullscreen","msallowfullscreen"),n.setAttribute("allowfullscreen","allowfullscreen"),document.getElementById("regionContainer").style.display="block",n.contentDocument.getElementById("end_mark_id").style.display="block",n.contentDocument.querySelector("html").setAttribute("dir",r),n.contentDocument.body.classList.add("contentBody"),n.contentDocument.body.style.paddingTop=e.READINGBAR_HEIGHT+"px",n.contentDocument.addEventListener("keydown",e=>{f||(36===e.keyCode?(e.preventDefault(),document.getElementById("MainContainer").scrollLeft=0,H(),n.contentWindow.scrollTo(0,0)):35===e.keyCode&&(e.preventDefault(),function(){let e=oe();switch(document.getElementById("MainContainer").scrollLeft=(e-1)*document.documentElement.clientWidth,H(),m){case 0:n.contentWindow.scrollTo(0,n.contentDocument.body.scrollWidth);break;case 1:n.contentWindow.scrollTo(0,n.contentDocument.body.scrollHeight)}}()))}),n.contentDocument.body.focus(),n.contentDocument.getElementById("source").focus()}function J(){if(G(),function(){let e=document.querySelector("html").lang;if(e&&0===e.indexOf("en")){let e=de("p");for(let t=0;t<e.length;t++){let i=e[t].innerText;if(i.length>0){/^[a-zA-Z]/.test(i)&&(e[t].classList.add("dropCaps"),e[t].id="dropCapsParagraph");break}}}}(),document.documentElement.clientWidth>=c&&!f){m=0,document.getElementById("navButtonContainer").style.display="block";let e=h*a;parseFloat(window.getComputedStyle(document.documentElement,null).fontSize)>=50&&(e=document.documentElement.clientWidth-(l+u)),j(),n.style.msFlowInto="main",n.removeAttribute("tabindex"),q(e),I(e)}else{m=1,n.setAttribute("tabindex","0"),j();let e=document.documentElement.clientWidth-(l+u);q(e),z(),n.style.height=document.documentElement.clientHeight+"px",n.style.width=document.documentElement.clientWidth+"px",n.style.msFlowInto="",n.style.display="block",n.style.margin="0px",n.style.padding="0px"}}function z(){let e=document.getElementById("regionContainer");for(;e.firstChild;)e.removeChild(e.firstChild);let t=document.getElementById("page_carousel");for(;t.firstChild;)t.removeChild(t.firstChild)}function W(){if(!0===g){let e=document.getElementById("MainContainer").scrollLeft;return z(),document.documentElement.clientWidth>=c&&!f?(J(),document.getElementById("MainContainer").scrollLeft=e):(document.getElementById("navButtonContainer").style.display="none",J()),i}return s}function X(){document.webkitIsFullScreen||(L=document.documentElement.clientHeight,v=document.documentElement.clientWidth,W()),V.trigger(void 0)}function G(){let t=document.querySelector("html").lang,i=window.navigator.language;if(t&&i&&0===t.indexOf("en")&&0===i.indexOf("en")){let t=250,i=4,s=n.contentDocument.body,o=Math.floor(60*s.innerText.split(/\s+/).length/t);if((o+=de("img").length*i)>=60){let t=Math.floor(o/60);if(void 0!==e.localizedStrings.Localized_TimeToRead_Min&&void 0!==e.localizedStrings.Localized_TimeToRead_Mins&&void 0!==e.localizedStrings.Localized_TimeToRead_Read){let i="";i=1===t?t+" "+e.localizedStrings.Localized_TimeToRead_Min+" "+e.localizedStrings.Localized_TimeToRead_Read:t+" "+e.localizedStrings.Localized_TimeToRead_Mins+" "+e.localizedStrings.Localized_TimeToRead_Read;let s=ue("timeToReadSpan");s?s.innerText=i:((s=document.createElement("span")).setAttribute("id","timeToReadSpan"),s.setAttribute("dir","ltr"),s.innerText=i,ue("timeToRead").appendChild(s))}}}}function K(t){e.localizedStrings=LearningTools.JsonUtilities.parseJsonOrNull(t,"localized strings")}function Y(){return Math.round(document.getElementById("MainContainer").scrollLeft/document.documentElement.clientWidth)}function Z(e){let t=document.getElementById("regionContainer"),i=t.firstElementChild.firstElementChild.getBoundingClientRect(),s=t.firstElementChild.firstElementChild.offsetLeft,n=Math.floor((document.documentElement.clientWidth-2*s)/i.width);return Math.floor(e.top/Math.floor(i.height*n))}function Q(){return.7*document.documentElement.clientHeight-ie()}function $(){let e=document.getElementById("lineFocusViewAnimationOverlay").getBoundingClientRect(),t=Math.floor(ee()),i=Math.floor(te());return{top:e.top+t,left:e.left,bottom:e.bottom-i,right:e.right,height:e.height-(t+i),width:e.width}}function ee(){let e=(se()-ne())/2;return w?ne():e}function te(){se(),ne();return w?(se()/2-ne())/2:(se()-ne())/2}function ie(){return ee()+te()}function se(){return parseFloat(window.getComputedStyle(n.contentDocument.body).lineHeight)}function ne(){return parseFloat(window.getComputedStyle(n.contentDocument.body).fontSize)}function oe(){return o>0?o:1}function re(){return document.documentElement.clientWidth}function he(){return document.documentElement.clientHeight}function ae(t){return t>y.size&&(t=e.FontSize.ExtraSmall),S!==t&&(document.documentElement.style.setProperty("--font-size",y.get(t)),n.contentDocument.documentElement.style.setProperty("--font-size",y.get(t)),S=t,p.trigger(t),W(),!0)}function le(t){switch(m){case 0:{let e=Z(t);return Y()===e}case 1:if(f){let e=$();return t.top>=e.top-2&&t.bottom<=e.bottom+2}{let i=document.documentElement.clientHeight;return t.top>e.READINGBAR_HEIGHT&&t.bottom<i}default:return!1}}function ue(e){return n.contentDocument.getElementById(e)}function de(e){return n.contentDocument.getElementsByTagName(e)}function ce(){let e=document.getElementById("MainContainer"),t=document.getElementById("leftButton"),i=document.getElementById("rightButton"),s=Math.round(e.scrollLeft/document.documentElement.clientWidth);t.style.display="block",i.style.display="block","ltr"===r?0===s?(t.style.display="none",1===oe()&&(i.style.display="none")):s===o-1&&(i.style.display="none"):0===s?(i.style.display="none",1===oe()&&(t.style.display="none")):s===o-1&&(t.style.display="none")}function ge(){document.webkitIsFullScreen||L!==document.documentElement.clientHeight||v!==document.documentElement.clientWidth||(window.addEventListener("resize",X),window.removeEventListener("resize",ge)),V.trigger(void 0)}function me(e,t,i,s){return new Promise(n=>{e.scrollTop;let o=0,r=performance.now(),h=Math.round(e.scrollTop+t),a=e.scrollTop;s&&s(),window.requestAnimationFrame(function s(l){if(o+=Math.PI/(i/(l-r)),e.scrollTop===h||o>=Math.PI)return e.scrollTop=h,n(!0);e.scrollTop=Math.round(a+t/2-t/2*Math.cos(o)),r=l,window.requestAnimationFrame(s)})})}e.initialize=P,e.adjustTablesLayout=O,e.scrollRight=F,e.scrollLeft=U,e.prepareAndPaginate=J,e.rePaginate=W,e.getArticleDirection=function(){return r},e.calcuteTimeToRead=G,e.initializeIframe=function(t){n.contentWindow.document.open("text/html","replace"),n.contentWindow.document.write('<!DOCTYPE html><html><head><meta http-equiv="Content-Security-Policy" content="script-src \'none\'; object-src \'none\'"><link href="ms-appx-web:///assets/ReadingView/css/ReadingViewStyle.css" rel="stylesheet"><base id="content_iframe_base" href="" target="_top" /></head><body><div class="header_container" id="__reading__mode__header__container"><div id="dominantimage_container" class="__reading__mode__extracted__dominant__image"><img id="dominantimage" src="" alt="" /><div class="__reading__mode__extracted__imagecontainer__caption" id="dominantimage_caption"></div></div><div id="header_pane_id"><div id="header_section_id"><div id="header_skew_section_id"><div id="header_content_id" class="header_content"><h1 class="__reading__mode__extracted__title" id="title" ></h1>\n<h4 class="__reading__mode__extracted__subtitle" id="subtitle"></h4>\n<div class="__reading__mode__bylineentries"><div class="__reading__mode__extracted__bylineentry" id="author" style="display:none;"></div>\n<div class="__reading__mode__extracted__bylineentry" id="metaData"><a id="source"></a><span id="metaDivider">|</span><span class="__reading__mode__extracted__date" id="publishdate"></span></div>\n<div class="__reading__mode__extracted__bylineentry" id="timeToRead"></div>\n</div></div></div></div></div></div><div id="mainContainer"></div><div><span class="endMarkIcon" style="display:none;" id="end_mark_id" ></span></div><div id= "pages_pending_container" class="pages_pending_container"><progress class="progress_pages_pending"></progress></div></body></html>'),n.contentWindow.document.close(),e.readingViewSettingsStoreProxy=new ReadingMode.ReadingViewSettingsStoreProxy(t),T.trigger(void 0)},e.onContentIframeInitialized=function(){return T},e.setBaseTagHref=function(e){document.getElementById("content_base").setAttribute("href",e),ue("content_iframe_base").setAttribute("href",e)},e.setLocalizedStrings=K,e.getCurrentPageNumber=Y,e.getPageFromRect=Z,e.getCurrentLayout=function(){return m},e.setLineMarkersActive=function(e){w=e},e.getIsLineFocusActive=function(){return f},e.enterLineFocusMode=function(){f||(f=!0,W(),document.body.classList.add("ms-linefocus-active"),n.contentDocument.body.classList.add("ms-linefocus-active"),document.getElementById("lineFocusUpButton").focus(),function(){let e=e=>{C.trigger(e)};k.push(LearningTools.DomUtilties.addReleasableDomEventListener(document,"wheel",e)),k.push(LearningTools.DomUtilties.addReleasableDomEventListener(n.contentDocument,"wheel",e));let t=e=>{M.trigger(e)};k.push(LearningTools.DomUtilties.addReleasableDomEventListener(document,"keydown",t)),k.push(LearningTools.DomUtilties.addReleasableDomEventListener(n.contentDocument,"keydown",t))}())},e.exitLineFocusMode=function(){f&&(document.getElementById("lineFocusView").style.height="100%",document.getElementById("lineFocusViewAnimationOverlay").style.height="100%",f=!1,document.body.classList.remove("ms-linefocus-active"),n.contentDocument.body.classList.remove("ms-linefocus-active"),W(),n.contentDocument.body.focus(),n.contentDocument.getElementById("source").focus(),k.forEach(e=>e.release()))},e.setLineFocusViewHeight=function(e){let t=$();if(Math.abs(e-t.height)>2){let t=Q(),i=ie(),s=Math.min(e,t)+i;document.getElementById("lineFocusView").style.height=s.toString()+"px",document.getElementById("lineFocusViewAnimationOverlay").style.height=s.toString()+"px"}},e.getMaxLineFocusViewHeight=Q,e.getLineFocusViewRect=$,e.getLineFocusViewMarginTop=ee,e.getLineFocusViewMarginBottom=te,e.getLineFocusViewMargins=ie,e.getBaseLineHeight=se,e.getFontSize=ne,e.getNumPages=oe,e.getBrowserWidth=re,e.getBrowserHeight=he,e.getContentIframe=function(){return n},e.getCurrentPageRanges=function(e){let t=[];if(0===m){let i=document.getElementById("regionContainer").children[e].children;for(let e=0;e<i.length;e++){let s=i[e].msGetRegionContent();for(let e=0;e<s.length;e++)t.push(s[e])}}return t},e.onFontSizeChanged=function(){return p},e.onTextSpacingApplied=function(){return b},e.onTextSpacingRemoved=function(){return R},e.onResized=function(){return V},e.onWheelInLineFocus=function(){return C},e.onKeyDownInLineFocus=function(){return M},e.applyTheme=function(t){t>N.size&&(t=e.Theme.Sepia),_!==t&&(document.documentElement.classList.remove(N.get(_)),n.contentDocument.documentElement.classList.remove(N.get(_)),document.documentElement.classList.add(N.get(t)),n.contentDocument.documentElement.classList.add(N.get(t)),_=t)},e.setFontSize=function(e){ae(e)&&telemetryClient&&telemetryClient.reportNumberOfPages(oe(),re(),he())},e.setFontSizeInternal=ae,e.applyTextSpacing=function(){b.trigger(void 0)},e.removeTextSpacing=function(){R.trigger(void 0)},e.isClientRectVisible=le,e.scrollClientRectIntoView=function(t,i,s=!0,o,r=!1){return new Promise(h=>{if(o||!le(t))switch(m){case 0:{i&&i();let e=Z(t);return document.getElementById("MainContainer").scrollLeft=e*document.documentElement.clientWidth,h(!0)}case 1:if(f){if(s){if(!r)return i&&i(),n.contentDocument.body.scrollTop+=t.top-$().top,h(!0);me(n.contentDocument.body,t.top-$().top,200,i).then(()=>h(!0))}else{if(!r)return i&&i(),n.contentDocument.body.scrollTop+=t.bottom-$().bottom,h(!0);me(n.contentDocument.body,t.bottom-$().bottom,200,i).then(()=>h(!0))}break}return i&&i(),n.contentDocument.body.scrollTop+=t.top-e.READINGBAR_HEIGHT,h(!0);default:return h(!1)}})},e.initiatePaginatedReadingView=function(s){document.getElementById("MainContainer").addEventListener("scroll",H),document.getElementById("rightButton").addEventListener("click",B),document.getElementById("leftButton").addEventListener("click",D),window.addEventListener("resize",X),document.addEventListener("webkitfullscreenchange",()=>{document.webkitIsFullScreen&&(window.removeEventListener("resize",X),window.addEventListener("resize",ge))});try{var o=n.contentDocument,h=()=>{"complete"===o.readyState&&(function(){let e=window.location.pathname,t=document.createElement("a");t.href=e,ue("source").innerText=t.hostname}(),K(s),r=document.querySelector("html").dir,O(n.contentDocument),J(),"rtl"===r?(document.getElementById("leftButton").setAttribute("aria-label",e.localizedStrings.Localized_FlipViewButton_Next),document.getElementById("leftButton").title=e.localizedStrings.Localized_FlipViewButton_Next,document.getElementById("rightButton").setAttribute("aria-label",e.localizedStrings.Localized_FlipViewButton_Previous),document.getElementById("rightButton").title=e.localizedStrings.Localized_FlipViewButton_Previous):(document.getElementById("leftButton").setAttribute("aria-label",e.localizedStrings.Localized_FlipViewButton_Previous),document.getElementById("leftButton").title=e.localizedStrings.Localized_FlipViewButton_Previous,document.getElementById("rightButton").setAttribute("aria-label",e.localizedStrings.Localized_FlipViewButton_Next),document.getElementById("rightButton").title=e.localizedStrings.Localized_FlipViewButton_Next),function(){let t=document.getElementById("lineFocusUpButton");t.setAttribute("aria-label",e.localizedStrings.LineFocus_MoveUp),t.setAttribute("title",e.localizedStrings.LineFocus_MoveUp);let i=document.getElementById("lineFocusDownButton");i.setAttribute("aria-label",e.localizedStrings.LineFocus_MoveDown),i.setAttribute("title",e.localizedStrings.LineFocus_MoveDown)}(),document.body.style.transition="background 1s ease-in-out",n.contentDocument.body.style.transition="background 1s ease-in-out",g=!0,o.getElementById("subtitle").addEventListener("animationstart",()=>{W()}),o.onreadystatechange=null,readingViewRuntime.postMessageToHost({message:"LearningToolsMessage",dataJson:["ReadingViewInitialized"]}))};"complete"===o.readyState?h():o.onreadystatechange=(()=>{h()})}catch(e){return t}return i},e.setProgressIndicatorVisible=function(e){document.getElementById("full_page_progress_container").style.display=e?"block":"none"},P()}(ReadingViewViewer||(ReadingViewViewer={})),function(e){let t;!function(e){e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e[e.Touch=2]="Touch",e[e.Pen=3]="Pen"}(t||(t={}));e.SelectionPreprocessor=class{constructor(){this.Bi=new LearningTools.EventSource,this.Di=new LearningTools.EventSource,this.qi=new LearningTools.EventSource,this.Hi={x:screen.width/2,y:screen.height/2}}listenToPointerEvents(e){let t=new LearningTools.ReleasableList;return t.add(LearningTools.DomUtilties.addReleasableDomEventListener(e,"pointerup",e=>{this.Hi={x:e.screenX,y:e.screenY},this.qi.trigger(e)})),t.add(LearningTools.DomUtilties.addReleasableDomEventListener(e,"pointerdown",e=>{this.Hi={x:e.screenX,y:e.screenY}})),t}preprocess(e){this.processSelectionEvents(e)}get mouseTouchOrPenSelectionReady(){return this.Bi}get touchOrPenSelectionFinished(){return this.Di}lastPointerActionScreenPosition(){return this.Hi}get mouseTouchOrPenSelectionReadySource(){return this.Bi}get touchOrPenSelectionFinishedSource(){return this.Di}processSelectionEvents(e){let i=t.Keyboard,s=!1;LearningTools.DomUtilties.addReleasableDomEventListener(e,"pointerdown",e=>{switch(e.pointerType){case"touch":i=t.Touch;break;case"pen":i=t.Pen,s=2===e.button;break;default:i=t.Mouse}}),LearningTools.DomUtilties.addReleasableDomEventListener(e,"keydown",e=>{i=t.Keyboard});let n=null,o=null,r=null;LearningTools.DomUtilties.addReleasableDomEventListener(e,"selectstart",h=>{if(o&&(o.release(),o=null),n&&(n.release(),n=null),r&&(r.release(),r=null),i===t.Touch){let t=this.registerToPenAndTouchSelectEvents(e);o=t.selectionChangeReleasable,n=t.selectReleasable}else if(i===t.Pen){if(!s){let t=this.registerToPenAndTouchSelectEvents(e);o=t.selectionChangeReleasable,n=t.selectReleasable}}else i===t.Mouse&&(r=this.qi.subscribe(t=>{r.release(),r=null,2!==t.button&&(o&&(o.release(),o=null),o=LearningTools.DomUtilties.addReleasableDomEventListener(e,"selectionchange",e=>{this.Bi.trigger(void 0)}),this.Bi.trigger(void 0))}))})}registerToPenAndTouchSelectEvents(e){return{selectionChangeReleasable:LearningTools.DomUtilties.addReleasableDomEventListener(e,"selectionchange",e=>{this.Bi.trigger(void 0)}),selectReleasable:LearningTools.DomUtilties.addReleasableDomEventListener(e,"select",e=>{this.Di.trigger(void 0)})}}}}(ReadingMode||(ReadingMode={})),function(e){const t=100,i=1e3;e.SelectionHandler=class{constructor(t,i){this.Ge=t,this.vt=i,this.T=i.getIframeDocument(),this.ji=this.T.createRange(),this.Ji=new e.SelectionPreprocessor,this.Ji.preprocess(this.T),this.zi=!1,this.Ge.enableLineFocusRequested().subscribe(()=>{this.zi=!0,this.dismissSelectionMenu()}),this.Ge.disableLineFocusRequested().subscribe(()=>{this.zi=!1}),this.Wi=new LearningTools.ReleasableList,this.Wi.add(this.Ji.listenToPointerEvents(i.getIframeDocument())),this.Wi.add(this.Ji.mouseTouchOrPenSelectionReady.subscribe(()=>this.onSelectionReady())),this.Wi.add(this.Ji.touchOrPenSelectionFinished.subscribe(()=>this.onSelectionReady())),this.Wi.add(this.vt.onScrollStart().subscribe(()=>this.dismissSelectionMenu())),this.Wi.add(LearningTools.DomUtilties.addReleasableDomEventListener(this.T,"contextmenu",e=>this.dismissSelectionMenu())),this.Wi.add(LearningTools.DomUtilties.addReleasableDomEventListener(this.T,"keydown",e=>{"Esc"!==e.key&&"Escape"!==e.key||this.dismissSelectionMenu()})),this.Wi.add(ReadingViewViewer.onResized().subscribe(()=>this.dismissSelectionMenu()))}unload(){this.Wi&&(this.Wi.release(),this.Wi=null)}onSelectionReady(){if(!this.zi){let e=this.vt.getSelection();if(e){let s=e.getRangeAt(0);if(0!=s.compareBoundaryPoints(Range.START_TO_START,this.ji)||0!=s.compareBoundaryPoints(Range.END_TO_END,this.ji)){let n=e.toString(),o=n.length;if(o<t){let e=(i-o)/2,t=s;LearningTools.ReadingRangeManipulations.expandRangeStart(t,e),LearningTools.ReadingRangeManipulations.expandRangeEnd(t,e);let r=this.Ji.lastPointerActionScreenPosition();this.Ge.sendReadingViewSelectionUi(n,t.toString(),r.x,r.y)}}this.ji=s}else this.dismissSelectionMenu()}}dismissSelectionMenu(){this.ji.collapsed||(this.ji=this.T.createRange(),this.Ge.sendReadingViewDismissSelectionUi())}}}(ReadingMode||(ReadingMode={})),function(e){e.ReadingViewSettingsEventHandlers=class{constructor(e,t){this.Ot=e,this.Ge=t,this.Ot.onSettingChanged().subscribe(e=>{this.Ge.sendReadingViewSettings(e.name,e.value)}),this.Ge.settingsUpdateRequested().subscribe(e=>{this.Ot.onSettingsUpdateFromHost(e)})}}}(ReadingMode||(ReadingMode={})),window.onerror=(e=>{if(learningToolsRuntime){var t=JSON.stringify({errorType:"script",errorContent:e});learningToolsRuntime.postMessageToHost([LearningTools.HostProxy.ReadOutLoudJsErrorTelemetryHostMessage,t])}}),window.readingViewController=external.CreateReadingViewController(),window.onunload=function(){window.readingViewController.close(0)},document.addEventListener("DOMContentLoaded",function(){window.onunload=function(){selectionHandler&&selectionHandler.unload(),readingViewRuntime.unload()}});let readingViewRuntime=new ReadingViewViewer.ReadingViewRuntime(window.readingViewController),learningToolsRuntime=new ReadingViewViewer.LearningToolsRuntime(readingViewRuntime);readingViewRuntime.setLearningToolsRuntime(learningToolsRuntime),window.readingViewController.bindViewer(readingViewRuntime);let telemetryClient=null;ReadingViewViewer.onContentIframeInitialized().subscribe(()=>{window.onbeforeprint=function(){ReadingViewViewer.getContentIframe().contentDocument.execCommand("print",!1,null)};let e=new ReadingMode.ReadingViewContentProvider(document),t=new ReadingMode.ReadingModeHostProxy(learningToolsRuntime),i=t;telemetryClient=new ReadingMode.TelemetryClient(i);let s=t,n=new ReadingMode.MainViewModel(i,s,e,ReadingViewViewer.readingViewSettingsStoreProxy);new LearningTools.ReadOutLoudEventHandlers(t,n,!1),new ReadingMode.LearningToolsEventHandlers(t,n),new ReadingMode.SelectionHandler(t,e),new ReadingMode.ReadingViewSettingsEventHandlers(ReadingViewViewer.readingViewSettingsStoreProxy,t)}),window.initializeIframe=ReadingViewViewer.initializeIframe,window.initiatePaginatedReadingView=ReadingViewViewer.initiatePaginatedReadingView,window.rePaginate=ReadingViewViewer.rePaginate,window.getNumPages=ReadingViewViewer.getNumPages,window.getBrowserWidth=ReadingViewViewer.getBrowserWidth,window.getBrowserHeight=ReadingViewViewer.getBrowserHeight,window.setBaseTagHref=ReadingViewViewer.setBaseTagHref;